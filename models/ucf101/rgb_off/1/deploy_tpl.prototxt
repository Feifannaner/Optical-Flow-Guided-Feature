name: "BN-Inception"
layer {
  name: "data"
  type: "VideoData"
  top: "data"
  top: "label"
  video_data_param {
    #source: "data/ucf101_rgb_val_split_1.txt"
    source:           $SOURCE
    batch_size:       1
    new_length:       1
    num_segments:     25
    roi_pool_flag:    false
    shuffle:          false
    modality:         RGB
    name_pattern:     "img_%05d.jpg"
    video_id_path:    $VIDEO_ID_PATH
  }
  transform_param{
    # crop_size: 224
    crop_width:       224
    crop_height:      224
    num_ch_per_seg:   3
    
    is_flow:          false
    is_pose:          false
    is_rgb_flow:      false
    is_roi:           false
    visualize:        false
    mirror:           false
    use_zero:         false
    fix_crop:         true
    oversample_type_path: $OVERSAMPLE_ID_PATH
    mean_value:       [104, 117, 123, 104, 117, 123, 104, 117, 123,
                      104, 117, 123, 104, 117, 123, 104, 117, 123,
                      104, 117, 123,
                       104, 117, 123, 104, 117, 123,
                      104, 117, 123, 104, 117, 123, 104, 117, 123,
                      104, 117, 123, 104, 117, 123, 104, 117, 123,
                      104, 117, 123, 104, 117, 123, 104, 117, 123,
                      104, 117, 123, 104, 117, 123, 104, 117, 123,
                      104, 117, 123, 104, 117, 123, 104, 117, 123,
                      104, 117, 123] #, 0, 0, 0
  }
  include: { phase: TEST }
}

layer { name: "reshape_data" type: "Reshape" bottom: "data" top: "reshape_data" reshape_param { shape { dim: -1 dim: 3 dim: 224 dim: 224 } } }
 
####################################### conv1 #######################################
layer { name: "conv1/7x7_s2" type: "Convolution" bottom: "reshape_data" top: "conv1/7x7_s2"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 pad: 3 kernel_size: 7 stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "conv1/7x7_s2_bn" type: "BN" bottom: "conv1/7x7_s2" top: "conv1/7x7_s2_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: false slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "conv1/relu_7x7" type: "ReLU" bottom: "conv1/7x7_s2_bn" top: "conv1/7x7_s2_bn" }
layer { name: "pool1/3x3_s2" type: "Pooling" bottom: "conv1/7x7_s2_bn" top: "pool1/3x3_s2"
  pooling_param { pool: MAX kernel_size: 3 stride: 2 } }

####################################### conv2 #######################################
layer { name: "conv2/3x3_reduce" type: "Convolution" bottom: "pool1/3x3_s2" top: "conv2/3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "conv2/3x3_reduce_bn" type: "BN" bottom: "conv2/3x3_reduce" top: "conv2/3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "conv2/relu_3x3_reduce" type: "ReLU" bottom: "conv2/3x3_reduce_bn" top: "conv2/3x3_reduce_bn" }
layer { name: "conv2/3x3" type: "Convolution" bottom: "conv2/3x3_reduce_bn" top: "conv2/3x3"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 192 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "conv2/3x3_bn" type: "BN" bottom: "conv2/3x3" top: "conv2/3x3_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "conv2/relu_3x3" type: "ReLU" bottom: "conv2/3x3_bn" top: "conv2/3x3_bn" }
layer { name: "pool2/3x3_s2" type: "Pooling" bottom: "conv2/3x3_bn" top: "pool2/3x3_s2"
  pooling_param { pool: MAX kernel_size: 3 stride: 2 } }

####################################### inception_3a #######################################
layer { name: "inception_3a/1x1" type: "Convolution" bottom: "pool2/3x3_s2" top: "inception_3a/1x1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3a/1x1_bn" type: "BN" bottom: "inception_3a/1x1" top: "inception_3a/1x1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3a/relu_1x1" type: "ReLU" bottom: "inception_3a/1x1_bn" top: "inception_3a/1x1_bn" }
layer { name: "inception_3a/3x3_reduce" type: "Convolution" bottom: "pool2/3x3_s2" top: "inception_3a/3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3a/3x3_reduce_bn" type: "BN" bottom: "inception_3a/3x3_reduce" top: "inception_3a/3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3a/relu_3x3_reduce" type: "ReLU" bottom: "inception_3a/3x3_reduce_bn" top: "inception_3a/3x3_reduce_bn" }
layer { name: "inception_3a/3x3" type: "Convolution" bottom: "inception_3a/3x3_reduce_bn" top: "inception_3a/3x3"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 pad: 1 kernel_size: 3
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3a/3x3_bn" type: "BN" bottom: "inception_3a/3x3" top: "inception_3a/3x3_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3a/relu_3x3" type: "ReLU" bottom: "inception_3a/3x3_bn" top: "inception_3a/3x3_bn" }
layer { name: "inception_3a/double_3x3_reduce" type: "Convolution" bottom: "pool2/3x3_s2" top: "inception_3a/double_3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3a/double_3x3_reduce_bn" type: "BN" bottom: "inception_3a/double_3x3_reduce" top: "inception_3a/double_3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3a/relu_double_3x3_reduce" type: "ReLU" bottom: "inception_3a/double_3x3_reduce_bn" top: "inception_3a/double_3x3_reduce_bn" }
layer { name: "inception_3a/double_3x3_1" type: "Convolution" bottom: "inception_3a/double_3x3_reduce_bn" top: "inception_3a/double_3x3_1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3a/double_3x3_1_bn" type: "BN" bottom: "inception_3a/double_3x3_1" top: "inception_3a/double_3x3_1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3a/relu_double_3x3_1" type: "ReLU" bottom: "inception_3a/double_3x3_1_bn" top: "inception_3a/double_3x3_1_bn" }
layer { name: "inception_3a/double_3x3_2" type: "Convolution" bottom: "inception_3a/double_3x3_1_bn" top: "inception_3a/double_3x3_2"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3a/double_3x3_2_bn" type: "BN" bottom: "inception_3a/double_3x3_2" top: "inception_3a/double_3x3_2_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3a/relu_double_3x3_2" type: "ReLU" bottom: "inception_3a/double_3x3_2_bn" top: "inception_3a/double_3x3_2_bn" }
layer { name: "inception_3a/pool" type: "Pooling" bottom: "pool2/3x3_s2" top: "inception_3a/pool"
  pooling_param { pool: AVE kernel_size: 3 stride: 1 pad: 1 } }
layer { name: "inception_3a/pool_proj" type: "Convolution" bottom: "inception_3a/pool" top: "inception_3a/pool_proj"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 32 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3a/pool_proj_bn" type: "BN" bottom: "inception_3a/pool_proj" top: "inception_3a/pool_proj_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3a/relu_pool_proj" type: "ReLU" bottom: "inception_3a/pool_proj_bn" top: "inception_3a/pool_proj_bn" }
layer { name: "inception_3a/output" type: "Concat"
  bottom: "inception_3a/1x1_bn"
  bottom: "inception_3a/3x3_bn"
  bottom: "inception_3a/double_3x3_2_bn"
  bottom: "inception_3a/pool_proj_bn"
  top: "inception_3a/output" }

####################################### inception_3b #######################################
layer { name: "inception_3b/1x1" type: "Convolution" bottom: "inception_3a/output" top: "inception_3b/1x1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3b/1x1_bn" type: "BN" bottom: "inception_3b/1x1" top: "inception_3b/1x1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3b/relu_1x1" type: "ReLU" bottom: "inception_3b/1x1_bn" top: "inception_3b/1x1_bn" }
layer { name: "inception_3b/3x3_reduce" type: "Convolution" bottom: "inception_3a/output" top: "inception_3b/3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3b/3x3_reduce_bn" type: "BN" bottom: "inception_3b/3x3_reduce" top: "inception_3b/3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3b/relu_3x3_reduce" type: "ReLU" bottom: "inception_3b/3x3_reduce_bn" top: "inception_3b/3x3_reduce_bn" }
layer { name: "inception_3b/3x3" type: "Convolution" bottom: "inception_3b/3x3_reduce_bn" top: "inception_3b/3x3"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 pad: 1 kernel_size: 3
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3b/3x3_bn" type: "BN" bottom: "inception_3b/3x3" top: "inception_3b/3x3_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3b/relu_3x3" type: "ReLU" bottom: "inception_3b/3x3_bn" top: "inception_3b/3x3_bn" }
layer { name: "inception_3b/double_3x3_reduce" type: "Convolution" bottom: "inception_3a/output" top: "inception_3b/double_3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3b/double_3x3_reduce_bn" type: "BN" bottom: "inception_3b/double_3x3_reduce" top: "inception_3b/double_3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3b/relu_double_3x3_reduce" type: "ReLU" bottom: "inception_3b/double_3x3_reduce_bn" top: "inception_3b/double_3x3_reduce_bn" }
layer { name: "inception_3b/double_3x3_1" type: "Convolution" bottom: "inception_3b/double_3x3_reduce_bn" top: "inception_3b/double_3x3_1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3b/double_3x3_1_bn" type: "BN" bottom: "inception_3b/double_3x3_1" top: "inception_3b/double_3x3_1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3b/relu_double_3x3_1" type: "ReLU" bottom: "inception_3b/double_3x3_1_bn" top: "inception_3b/double_3x3_1_bn" }
layer { name: "inception_3b/double_3x3_2" type: "Convolution" bottom: "inception_3b/double_3x3_1_bn" top: "inception_3b/double_3x3_2"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3b/double_3x3_2_bn" type: "BN" bottom: "inception_3b/double_3x3_2" top: "inception_3b/double_3x3_2_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3b/relu_double_3x3_2" type: "ReLU" bottom: "inception_3b/double_3x3_2_bn" top: "inception_3b/double_3x3_2_bn" }
layer { name: "inception_3b/pool" type: "Pooling" bottom: "inception_3a/output" top: "inception_3b/pool"
  pooling_param { pool: AVE kernel_size: 3 stride: 1 pad: 1 } }
layer { name: "inception_3b/pool_proj" type: "Convolution" bottom: "inception_3b/pool" top: "inception_3b/pool_proj"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3b/pool_proj_bn" type: "BN" bottom: "inception_3b/pool_proj" top: "inception_3b/pool_proj_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3b/relu_pool_proj" type: "ReLU" bottom: "inception_3b/pool_proj_bn" top: "inception_3b/pool_proj_bn" }
layer { name: "inception_3b/output" type: "Concat"
  bottom: "inception_3b/1x1_bn"
  bottom: "inception_3b/3x3_bn"
  bottom: "inception_3b/double_3x3_2_bn"
  bottom: "inception_3b/pool_proj_bn"
  top: "inception_3b/output" }

  # layer { name: "inception_3b/prediction" type: "Convolution"
  # bottom: "inception_3b/output"
  # top: "inception_3b/prediction" }

####################################### inception_3c #######################################
layer { name: "inception_3c/3x3_reduce" type: "Convolution" bottom: "inception_3b/output" top: "inception_3c/3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3c/3x3_reduce_bn" type: "BN" bottom: "inception_3c/3x3_reduce" top: "inception_3c/3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3c/relu_3x3_reduce" type: "ReLU" bottom: "inception_3c/3x3_reduce_bn" top: "inception_3c/3x3_reduce_bn" }
layer { name: "inception_3c/3x3" type: "Convolution" bottom: "inception_3c/3x3_reduce_bn" top: "inception_3c/3x3"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 160 pad: 1 kernel_size: 3 stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3c/3x3_bn" type: "BN" bottom: "inception_3c/3x3" top: "inception_3c/3x3_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3c/relu_3x3" type: "ReLU" bottom: "inception_3c/3x3_bn" top: "inception_3c/3x3_bn" }
layer { name: "inception_3c/double_3x3_reduce" type: "Convolution" bottom: "inception_3b/output" top: "inception_3c/double_3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3c/double_3x3_reduce_bn" type: "BN" bottom: "inception_3c/double_3x3_reduce" top: "inception_3c/double_3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3c/relu_double_3x3_reduce" type: "ReLU" bottom: "inception_3c/double_3x3_reduce_bn" top: "inception_3c/double_3x3_reduce_bn" }
layer { name: "inception_3c/double_3x3_1" type: "Convolution" bottom: "inception_3c/double_3x3_reduce_bn" top: "inception_3c/double_3x3_1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3c/double_3x3_1_bn" type: "BN" bottom: "inception_3c/double_3x3_1" top: "inception_3c/double_3x3_1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3c/relu_double_3x3_1" type: "ReLU" bottom: "inception_3c/double_3x3_1_bn" top: "inception_3c/double_3x3_1_bn" }
layer { name: "inception_3c/double_3x3_2" type: "Convolution" bottom: "inception_3c/double_3x3_1_bn" top: "inception_3c/double_3x3_2"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 pad: 1 kernel_size: 3 stride: 2
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_3c/double_3x3_2_bn" type: "BN" bottom: "inception_3c/double_3x3_2" top: "inception_3c/double_3x3_2_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_3c/relu_double_3x3_2" type: "ReLU" bottom: "inception_3c/double_3x3_2_bn" top: "inception_3c/double_3x3_2_bn" }
layer { name: "inception_3c/pool" type: "Pooling" bottom: "inception_3b/output" top: "inception_3c/pool"
  pooling_param { pool: MAX kernel_size: 3 stride: 2 } }
layer { name: "inception_3c/output" type: "Concat"
  bottom: "inception_3c/3x3_bn"
  bottom: "inception_3c/double_3x3_2_bn"
  bottom: "inception_3c/pool"
  top: "inception_3c/output" }

####################################### inception_4a #######################################
layer { name: "inception_4a/1x1" type: "Convolution" bottom: "inception_3c/output" top: "inception_4a/1x1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 224 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4a/1x1_bn" type: "BN" bottom: "inception_4a/1x1" top: "inception_4a/1x1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4a/relu_1x1" type: "ReLU" bottom: "inception_4a/1x1_bn" top: "inception_4a/1x1_bn" }
layer { name: "inception_4a/3x3_reduce" type: "Convolution" bottom: "inception_3c/output" top: "inception_4a/3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 64 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4a/3x3_reduce_bn" type: "BN" bottom: "inception_4a/3x3_reduce" top: "inception_4a/3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4a/relu_3x3_reduce" type: "ReLU" bottom: "inception_4a/3x3_reduce_bn" top: "inception_4a/3x3_reduce_bn" }
layer { name: "inception_4a/3x3" type: "Convolution" bottom: "inception_4a/3x3_reduce_bn" top: "inception_4a/3x3"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 pad: 1 kernel_size: 3
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4a/3x3_bn" type: "BN" bottom: "inception_4a/3x3" top: "inception_4a/3x3_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4a/relu_3x3" type: "ReLU" bottom: "inception_4a/3x3_bn" top: "inception_4a/3x3_bn" }
layer { name: "inception_4a/double_3x3_reduce" type: "Convolution" bottom: "inception_3c/output" top: "inception_4a/double_3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4a/double_3x3_reduce_bn" type: "BN" bottom: "inception_4a/double_3x3_reduce" top: "inception_4a/double_3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4a/relu_double_3x3_reduce" type: "ReLU" bottom: "inception_4a/double_3x3_reduce_bn" top: "inception_4a/double_3x3_reduce_bn" }
layer { name: "inception_4a/double_3x3_1" type: "Convolution" bottom: "inception_4a/double_3x3_reduce_bn" top: "inception_4a/double_3x3_1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4a/double_3x3_1_bn" type: "BN" bottom: "inception_4a/double_3x3_1" top: "inception_4a/double_3x3_1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4a/relu_double_3x3_1" type: "ReLU" bottom: "inception_4a/double_3x3_1_bn" top: "inception_4a/double_3x3_1_bn" }
layer { name: "inception_4a/double_3x3_2" type: "Convolution" bottom: "inception_4a/double_3x3_1_bn" top: "inception_4a/double_3x3_2"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4a/double_3x3_2_bn" type: "BN" bottom: "inception_4a/double_3x3_2" top: "inception_4a/double_3x3_2_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4a/relu_double_3x3_2" type: "ReLU" bottom: "inception_4a/double_3x3_2_bn" top: "inception_4a/double_3x3_2_bn" }
layer { name: "inception_4a/pool" type: "Pooling" bottom: "inception_3c/output" top: "inception_4a/pool"
  pooling_param { pool: AVE kernel_size: 3 stride: 1 pad: 1 } }
layer { name: "inception_4a/pool_proj" type: "Convolution" bottom: "inception_4a/pool" top: "inception_4a/pool_proj"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4a/pool_proj_bn" type: "BN" bottom: "inception_4a/pool_proj" top: "inception_4a/pool_proj_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4a/relu_pool_proj" type: "ReLU" bottom: "inception_4a/pool_proj_bn" top: "inception_4a/pool_proj_bn" }
layer { name: "inception_4a/output" type: "Concat"
  bottom: "inception_4a/1x1_bn"
  bottom: "inception_4a/3x3_bn"
  bottom: "inception_4a/double_3x3_2_bn"
  bottom: "inception_4a/pool_proj_bn"
  top: "inception_4a/output" }

####################################### inception_4b #######################################
layer { name: "inception_4b/1x1" type: "Convolution" bottom: "inception_4a/output" top: "inception_4b/1x1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 192 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4b/1x1_bn" type: "BN" bottom: "inception_4b/1x1" top: "inception_4b/1x1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4b/relu_1x1" type: "ReLU" bottom: "inception_4b/1x1_bn" top: "inception_4b/1x1_bn" }
layer { name: "inception_4b/3x3_reduce" type: "Convolution" bottom: "inception_4a/output" top: "inception_4b/3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4b/3x3_reduce_bn" type: "BN" bottom: "inception_4b/3x3_reduce" top: "inception_4b/3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4b/relu_3x3_reduce" type: "ReLU" bottom: "inception_4b/3x3_reduce_bn" top: "inception_4b/3x3_reduce_bn" }
layer { name: "inception_4b/3x3" type: "Convolution" bottom: "inception_4b/3x3_reduce_bn" top: "inception_4b/3x3"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 pad: 1 kernel_size: 3
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4b/3x3_bn" type: "BN" bottom: "inception_4b/3x3" top: "inception_4b/3x3_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4b/relu_3x3" type: "ReLU" bottom: "inception_4b/3x3_bn" top: "inception_4b/3x3_bn" }
layer { name: "inception_4b/double_3x3_reduce" type: "Convolution" bottom: "inception_4a/output" top: "inception_4b/double_3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4b/double_3x3_reduce_bn" type: "BN" bottom: "inception_4b/double_3x3_reduce" top: "inception_4b/double_3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4b/relu_double_3x3_reduce" type: "ReLU" bottom: "inception_4b/double_3x3_reduce_bn" top: "inception_4b/double_3x3_reduce_bn" }
layer { name: "inception_4b/double_3x3_1" type: "Convolution" bottom: "inception_4b/double_3x3_reduce_bn" top: "inception_4b/double_3x3_1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4b/double_3x3_1_bn" type: "BN" bottom: "inception_4b/double_3x3_1" top: "inception_4b/double_3x3_1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4b/relu_double_3x3_1" type: "ReLU" bottom: "inception_4b/double_3x3_1_bn" top: "inception_4b/double_3x3_1_bn" }
layer { name: "inception_4b/double_3x3_2" type: "Convolution" bottom: "inception_4b/double_3x3_1_bn" top: "inception_4b/double_3x3_2"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4b/double_3x3_2_bn" type: "BN" bottom: "inception_4b/double_3x3_2" top: "inception_4b/double_3x3_2_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4b/relu_double_3x3_2" type: "ReLU" bottom: "inception_4b/double_3x3_2_bn" top: "inception_4b/double_3x3_2_bn" }
layer { name: "inception_4b/pool" type: "Pooling" bottom: "inception_4a/output" top: "inception_4b/pool"
  pooling_param { pool: AVE kernel_size: 3 stride: 1 pad: 1 } }
layer { name: "inception_4b/pool_proj" type: "Convolution" bottom: "inception_4b/pool" top: "inception_4b/pool_proj"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4b/pool_proj_bn" type: "BN" bottom: "inception_4b/pool_proj" top: "inception_4b/pool_proj_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4b/relu_pool_proj" type: "ReLU" bottom: "inception_4b/pool_proj_bn" top: "inception_4b/pool_proj_bn" }
layer { name: "inception_4b/output" type: "Concat"
  bottom: "inception_4b/1x1_bn"
  bottom: "inception_4b/3x3_bn"
  bottom: "inception_4b/double_3x3_2_bn"
  bottom: "inception_4b/pool_proj_bn"
  top: "inception_4b/output" }

####################################### inception_4c #######################################
layer { name: "inception_4c/1x1" type: "Convolution" bottom: "inception_4b/output" top: "inception_4c/1x1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 160 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4c/1x1_bn" type: "BN" bottom: "inception_4c/1x1" top: "inception_4c/1x1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4c/relu_1x1" type: "ReLU" bottom: "inception_4c/1x1_bn" top: "inception_4c/1x1_bn" }
layer { name: "inception_4c/3x3_reduce" type: "Convolution" bottom: "inception_4b/output" top: "inception_4c/3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4c/3x3_reduce_bn" type: "BN" bottom: "inception_4c/3x3_reduce" top: "inception_4c/3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4c/relu_3x3_reduce" type: "ReLU" bottom: "inception_4c/3x3_reduce_bn" top: "inception_4c/3x3_reduce_bn" }
layer { name: "inception_4c/3x3" type: "Convolution" bottom: "inception_4c/3x3_reduce_bn" top: "inception_4c/3x3"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 160 pad: 1 kernel_size: 3
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4c/3x3_bn" type: "BN" bottom: "inception_4c/3x3" top: "inception_4c/3x3_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4c/relu_3x3" type: "ReLU" bottom: "inception_4c/3x3_bn" top: "inception_4c/3x3_bn" }
layer { name: "inception_4c/double_3x3_reduce" type: "Convolution" bottom: "inception_4b/output" top: "inception_4c/double_3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4c/double_3x3_reduce_bn" type: "BN" bottom: "inception_4c/double_3x3_reduce" top: "inception_4c/double_3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4c/relu_double_3x3_reduce" type: "ReLU" bottom: "inception_4c/double_3x3_reduce_bn" top: "inception_4c/double_3x3_reduce_bn" }
layer { name: "inception_4c/double_3x3_1" type: "Convolution" bottom: "inception_4c/double_3x3_reduce_bn" top: "inception_4c/double_3x3_1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 160 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4c/double_3x3_1_bn" type: "BN" bottom: "inception_4c/double_3x3_1" top: "inception_4c/double_3x3_1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4c/relu_double_3x3_1" type: "ReLU" bottom: "inception_4c/double_3x3_1_bn" top: "inception_4c/double_3x3_1_bn" }
layer { name: "inception_4c/double_3x3_2" type: "Convolution" bottom: "inception_4c/double_3x3_1_bn" top: "inception_4c/double_3x3_2"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 160 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4c/double_3x3_2_bn" type: "BN" bottom: "inception_4c/double_3x3_2" top: "inception_4c/double_3x3_2_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4c/relu_double_3x3_2" type: "ReLU" bottom: "inception_4c/double_3x3_2_bn" top: "inception_4c/double_3x3_2_bn" }
layer { name: "inception_4c/pool" type: "Pooling" bottom: "inception_4b/output" top: "inception_4c/pool"
  pooling_param { pool: AVE kernel_size: 3 stride: 1 pad: 1 } }
layer { name: "inception_4c/pool_proj" type: "Convolution" bottom: "inception_4c/pool" top: "inception_4c/pool_proj"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4c/pool_proj_bn" type: "BN" bottom: "inception_4c/pool_proj" top: "inception_4c/pool_proj_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4c/relu_pool_proj" type: "ReLU" bottom: "inception_4c/pool_proj_bn" top: "inception_4c/pool_proj_bn" }
layer { name: "inception_4c/output" type: "Concat"
  bottom: "inception_4c/1x1_bn"
  bottom: "inception_4c/3x3_bn"
  bottom: "inception_4c/double_3x3_2_bn"
  bottom: "inception_4c/pool_proj_bn"
  top: "inception_4c/output" }

####################################### inception_4d #######################################
layer { name: "inception_4d/1x1" type: "Convolution" bottom: "inception_4c/output" top: "inception_4d/1x1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 96 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4d/1x1_bn" type: "BN" bottom: "inception_4d/1x1" top: "inception_4d/1x1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4d/relu_1x1" type: "ReLU" bottom: "inception_4d/1x1_bn" top: "inception_4d/1x1_bn" }
layer { name: "inception_4d/3x3_reduce" type: "Convolution" bottom: "inception_4c/output" top: "inception_4d/3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4d/3x3_reduce_bn" type: "BN" bottom: "inception_4d/3x3_reduce" top: "inception_4d/3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4d/relu_3x3_reduce" type: "ReLU" bottom: "inception_4d/3x3_reduce_bn" top: "inception_4d/3x3_reduce_bn" }
layer { name: "inception_4d/3x3" type: "Convolution" bottom: "inception_4d/3x3_reduce_bn" top: "inception_4d/3x3"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 192 pad: 1 kernel_size: 3
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4d/3x3_bn" type: "BN" bottom: "inception_4d/3x3" top: "inception_4d/3x3_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4d/relu_3x3" type: "ReLU" bottom: "inception_4d/3x3_bn" top: "inception_4d/3x3_bn" }
layer { name: "inception_4d/double_3x3_reduce" type: "Convolution" bottom: "inception_4c/output" top: "inception_4d/double_3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 160 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4d/double_3x3_reduce_bn" type: "BN" bottom: "inception_4d/double_3x3_reduce" top: "inception_4d/double_3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4d/relu_double_3x3_reduce" type: "ReLU" bottom: "inception_4d/double_3x3_reduce_bn" top: "inception_4d/double_3x3_reduce_bn" }
layer { name: "inception_4d/double_3x3_1" type: "Convolution" bottom: "inception_4d/double_3x3_reduce_bn" top: "inception_4d/double_3x3_1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 192 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4d/double_3x3_1_bn" type: "BN" bottom: "inception_4d/double_3x3_1" top: "inception_4d/double_3x3_1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4d/relu_double_3x3_1" type: "ReLU" bottom: "inception_4d/double_3x3_1_bn" top: "inception_4d/double_3x3_1_bn" }
layer { name: "inception_4d/double_3x3_2" type: "Convolution" bottom: "inception_4d/double_3x3_1_bn" top: "inception_4d/double_3x3_2"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 192 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4d/double_3x3_2_bn" type: "BN" bottom: "inception_4d/double_3x3_2" top: "inception_4d/double_3x3_2_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4d/relu_double_3x3_2" type: "ReLU" bottom: "inception_4d/double_3x3_2_bn" top: "inception_4d/double_3x3_2_bn" }
layer { name: "inception_4d/pool" type: "Pooling" bottom: "inception_4c/output" top: "inception_4d/pool"
  pooling_param { pool: AVE kernel_size: 3 stride: 1 pad: 1 } }
layer { name: "inception_4d/pool_proj" type: "Convolution" bottom: "inception_4d/pool" top: "inception_4d/pool_proj"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4d/pool_proj_bn" type: "BN" bottom: "inception_4d/pool_proj" top: "inception_4d/pool_proj_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4d/relu_pool_proj" type: "ReLU" bottom: "inception_4d/pool_proj_bn" top: "inception_4d/pool_proj_bn" }
layer { name: "inception_4d/output" type: "Concat"
  bottom: "inception_4d/1x1_bn"
  bottom: "inception_4d/3x3_bn"
  bottom: "inception_4d/double_3x3_2_bn"
  bottom: "inception_4d/pool_proj_bn"
  top: "inception_4d/output" }

####################################### inception_4e #######################################
layer { name: "inception_4e/3x3_reduce" type: "Convolution" bottom: "inception_4d/output" top: "inception_4e/3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4e/3x3_reduce_bn" type: "BN" bottom: "inception_4e/3x3_reduce" top: "inception_4e/3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4e/relu_3x3_reduce" type: "ReLU" bottom: "inception_4e/3x3_reduce_bn" top: "inception_4e/3x3_reduce_bn" }
layer { name: "inception_4e/3x3" type: "Convolution" bottom: "inception_4e/3x3_reduce_bn" top: "inception_4e/3x3"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 192 pad: 1 kernel_size: 3 stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4e/3x3_bn" type: "BN" bottom: "inception_4e/3x3" top: "inception_4e/3x3_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4e/relu_3x3" type: "ReLU" bottom: "inception_4e/3x3_bn" top: "inception_4e/3x3_bn" }
layer { name: "inception_4e/double_3x3_reduce" type: "Convolution" bottom: "inception_4d/output" top: "inception_4e/double_3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 192 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4e/double_3x3_reduce_bn" type: "BN" bottom: "inception_4e/double_3x3_reduce" top: "inception_4e/double_3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4e/relu_double_3x3_reduce" type: "ReLU" bottom: "inception_4e/double_3x3_reduce_bn" top: "inception_4e/double_3x3_reduce_bn" }
layer { name: "inception_4e/double_3x3_1" type: "Convolution" bottom: "inception_4e/double_3x3_reduce_bn" top: "inception_4e/double_3x3_1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 256 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4e/double_3x3_1_bn" type: "BN" bottom: "inception_4e/double_3x3_1" top: "inception_4e/double_3x3_1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4e/relu_double_3x3_1" type: "ReLU" bottom: "inception_4e/double_3x3_1_bn" top: "inception_4e/double_3x3_1_bn" }
layer { name: "inception_4e/double_3x3_2" type: "Convolution" bottom: "inception_4e/double_3x3_1_bn" top: "inception_4e/double_3x3_2"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 256 pad: 1 kernel_size: 3 stride: 2
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_4e/double_3x3_2_bn" type: "BN" bottom: "inception_4e/double_3x3_2" top: "inception_4e/double_3x3_2_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_4e/relu_double_3x3_2" type: "ReLU" bottom: "inception_4e/double_3x3_2_bn" top: "inception_4e/double_3x3_2_bn" }
layer { name: "inception_4e/pool" type: "Pooling" bottom: "inception_4d/output" top: "inception_4e/pool"
  pooling_param { pool: MAX kernel_size: 3 stride: 2 } }
layer { name: "inception_4e/output" type: "Concat"
  bottom: "inception_4e/3x3_bn"
  bottom: "inception_4e/double_3x3_2_bn"
  bottom: "inception_4e/pool"
  top: "inception_4e/output" }

####################################### inception_5a #######################################
layer { name: "inception_5a/1x1" type: "Convolution" bottom: "inception_4e/output" top: "inception_5a/1x1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 352 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5a/1x1_bn" type: "BN" bottom: "inception_5a/1x1" top: "inception_5a/1x1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5a/relu_1x1" type: "ReLU" bottom: "inception_5a/1x1_bn" top: "inception_5a/1x1_bn" }
layer { name: "inception_5a/3x3_reduce" type: "Convolution" bottom: "inception_4e/output" top: "inception_5a/3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 192 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5a/3x3_reduce_bn" type: "BN" bottom: "inception_5a/3x3_reduce" top: "inception_5a/3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5a/relu_3x3_reduce" type: "ReLU" bottom: "inception_5a/3x3_reduce_bn" top: "inception_5a/3x3_reduce_bn" }
layer { name: "inception_5a/3x3" type: "Convolution" bottom: "inception_5a/3x3_reduce_bn" top: "inception_5a/3x3"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 320 pad: 1 kernel_size: 3
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5a/3x3_bn" type: "BN" bottom: "inception_5a/3x3" top: "inception_5a/3x3_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5a/relu_3x3" type: "ReLU" bottom: "inception_5a/3x3_bn" top: "inception_5a/3x3_bn" }
layer { name: "inception_5a/double_3x3_reduce" type: "Convolution" bottom: "inception_4e/output" top: "inception_5a/double_3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 160 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5a/double_3x3_reduce_bn" type: "BN" bottom: "inception_5a/double_3x3_reduce" top: "inception_5a/double_3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5a/relu_double_3x3_reduce" type: "ReLU" bottom: "inception_5a/double_3x3_reduce_bn" top: "inception_5a/double_3x3_reduce_bn" }
layer { name: "inception_5a/double_3x3_1" type: "Convolution" bottom: "inception_5a/double_3x3_reduce_bn" top: "inception_5a/double_3x3_1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 224 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5a/double_3x3_1_bn" type: "BN" bottom: "inception_5a/double_3x3_1" top: "inception_5a/double_3x3_1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5a/relu_double_3x3_1" type: "ReLU" bottom: "inception_5a/double_3x3_1_bn" top: "inception_5a/double_3x3_1_bn" }
layer { name: "inception_5a/double_3x3_2" type: "Convolution" bottom: "inception_5a/double_3x3_1_bn" top: "inception_5a/double_3x3_2"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 224 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5a/double_3x3_2_bn" type: "BN" bottom: "inception_5a/double_3x3_2" top: "inception_5a/double_3x3_2_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5a/relu_double_3x3_2" type: "ReLU" bottom: "inception_5a/double_3x3_2_bn" top: "inception_5a/double_3x3_2_bn" }
layer { name: "inception_5a/pool" type: "Pooling" bottom: "inception_4e/output" top: "inception_5a/pool"
  pooling_param { pool: AVE kernel_size: 3 stride: 1 pad: 1 } }
layer { name: "inception_5a/pool_proj" type: "Convolution" bottom: "inception_5a/pool" top: "inception_5a/pool_proj"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5a/pool_proj_bn" type: "BN" bottom: "inception_5a/pool_proj" top: "inception_5a/pool_proj_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5a/relu_pool_proj" type: "ReLU" bottom: "inception_5a/pool_proj_bn" top: "inception_5a/pool_proj_bn" }
layer { name: "inception_5a/output" type: "Concat"
  bottom: "inception_5a/1x1_bn"
  bottom: "inception_5a/3x3_bn"
  bottom: "inception_5a/double_3x3_2_bn"
  bottom: "inception_5a/pool_proj_bn"
  top: "inception_5a/output" }

####################################### inception_5b #######################################
layer { name: "inception_5b/1x1" type: "Convolution" bottom: "inception_5a/output" top: "inception_5b/1x1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 352 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5b/1x1_bn" type: "BN" bottom: "inception_5b/1x1" top: "inception_5b/1x1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5b/relu_1x1" type: "ReLU" bottom: "inception_5b/1x1_bn" top: "inception_5b/1x1_bn" }
layer { name: "inception_5b/3x3_reduce" type: "Convolution" bottom: "inception_5a/output" top: "inception_5b/3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 192 kernel_size: 1
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5b/3x3_reduce_bn" type: "BN" bottom: "inception_5b/3x3_reduce" top: "inception_5b/3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5b/relu_3x3_reduce" type: "ReLU" bottom: "inception_5b/3x3_reduce_bn" top: "inception_5b/3x3_reduce_bn" }
layer { name: "inception_5b/3x3" type: "Convolution" bottom: "inception_5b/3x3_reduce_bn" top: "inception_5b/3x3"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 320 pad: 1 kernel_size: 3
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5b/3x3_bn" type: "BN" bottom: "inception_5b/3x3" top: "inception_5b/3x3_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5b/relu_3x3" type: "ReLU" bottom: "inception_5b/3x3_bn" top: "inception_5b/3x3_bn" }
layer { name: "inception_5b/double_3x3_reduce" type: "Convolution" bottom: "inception_5a/output" top: "inception_5b/double_3x3_reduce"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 192 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5b/double_3x3_reduce_bn" type: "BN" bottom: "inception_5b/double_3x3_reduce" top: "inception_5b/double_3x3_reduce_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5b/relu_double_3x3_reduce" type: "ReLU" bottom: "inception_5b/double_3x3_reduce_bn" top: "inception_5b/double_3x3_reduce_bn" }
layer { name: "inception_5b/double_3x3_1" type: "Convolution" bottom: "inception_5b/double_3x3_reduce_bn" top: "inception_5b/double_3x3_1"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 224 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5b/double_3x3_1_bn" type: "BN" bottom: "inception_5b/double_3x3_1" top: "inception_5b/double_3x3_1_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5b/relu_double_3x3_1" type: "ReLU" bottom: "inception_5b/double_3x3_1_bn" top: "inception_5b/double_3x3_1_bn" }
layer { name: "inception_5b/double_3x3_2" type: "Convolution" bottom: "inception_5b/double_3x3_1_bn" top: "inception_5b/double_3x3_2"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 224 pad: 1 kernel_size: 3
    weight_filler { type: "msra"}
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5b/double_3x3_2_bn" type: "BN" bottom: "inception_5b/double_3x3_2" top: "inception_5b/double_3x3_2_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5b/relu_double_3x3_2" type: "ReLU" bottom: "inception_5b/double_3x3_2_bn" top: "inception_5b/double_3x3_2_bn" }
layer { name: "inception_5b/pool" type: "Pooling" bottom: "inception_5a/output" top: "inception_5b/pool"
  pooling_param { pool: MAX kernel_size: 3 stride: 1 pad: 1 } }
layer { name: "inception_5b/pool_proj" type: "Convolution" bottom: "inception_5b/pool" top: "inception_5b/pool_proj"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  convolution_param { num_output: 128 kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } } }
layer { name: "inception_5b/pool_proj_bn" type: "BN" bottom: "inception_5b/pool_proj" top: "inception_5b/pool_proj_bn"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  bn_param { frozen: true slope_filler { type: "constant" value: 1 } bias_filler { type: "constant" value: 0 } } }
layer { name: "inception_5b/relu_pool_proj" type: "ReLU" bottom: "inception_5b/pool_proj_bn" top: "inception_5b/pool_proj_bn" }
layer { name: "inception_5b/output" type: "Concat"
  bottom: "inception_5b/1x1_bn"
  bottom: "inception_5b/3x3_bn"
  bottom: "inception_5b/double_3x3_2_bn"
  bottom: "inception_5b/pool_proj_bn"
  top: "inception_5b/output" }

layer { name: "global_pool" top: "global_pool" bottom: "inception_5b/output" type: "Pooling"
  pooling_param { pool: AVE kernel_size: 7 stride: 1 } }
layer { name: "dropout" top: "global_pool" bottom: "global_pool" type: "Dropout"
 dropout_param { dropout_ratio: 0.8 } }

 layer { name: "fc-action" type: "InnerProduct" bottom: "global_pool" top: "fc"
  param { lr_mult: 0 decay_mult: 0 } param { lr_mult: 0 decay_mult: 0 }
  inner_product_param { num_output: 101
    weight_filler { type: "gaussian" std: 0.001 }
    bias_filler { type: "constant" value: 0 } } }



###################################### motion_3a ######################################


layer { 
  name: "motion_conv_gen_3a" 
  type: "Convolution" 
  bottom: "inception_3a/output" 
  top: "motion_conv_gen_3a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}


layer { 
  name: "motion_relu_gen_3a" 
  type: "ReLU" 
  bottom: "motion_conv_gen_3a" 
  top: "motion_conv_gen_3a"
}

layer { 
  name: "reshape_rgb_frames_3a" 
  type: "Reshape" 
  bottom: "motion_conv_gen_3a" 
  top: "reshape_rgb_frames_3a" 
  reshape_param { shape { dim: [16, -1, 28, 28] } } 
  include { phase: TRAIN }
} 

layer { 
  name: "reshape_rgb_frames_3a" 
  type: "Reshape" 
  bottom: "motion_conv_gen_3a" 
  top: "reshape_rgb_frames_3a" 
  reshape_param { shape { dim: [1, -1, 28, 28] } } 
  include { phase: TEST }
} 



layer {
  name: "slice_motion_last_3a"
  type: "Slice"
  bottom: "reshape_rgb_frames_3a"
  top: "first_frame_3a"
  top: "last_frames_3a"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_3a"
  type: "Slice"
  bottom: "reshape_rgb_frames_3a"
  top: "first_frames_3a"
  top: "last_frame_3a"
  slice_param {
    axis: 1
    slice_point: 768
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_last_3a"
  type: "Slice"
  bottom: "reshape_rgb_frames_3a"
  top: "first_frame_3a"
  top: "last_frames_3a"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TEST }
}

layer {
  name: "slice_motion_first_3a"
  type: "Slice"
  bottom: "reshape_rgb_frames_3a"
  top: "first_frames_3a"
  top: "last_frame_3a"
  slice_param {
    axis: 1
    slice_point: 3072 #6144 # 3072# 24*1024
  }
  include { phase: TEST }
}



# layer {
#   name: "slice_motion_last_second_3a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3a"
#   top: "second_frame_3a"
#   top: "last_second_frames_3a"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TRAIN }
# }

# layer {
#   name: "slice_motion_second_3a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3a"
#   top: "second_frames_3a"
#   top: "last_second_frame_3a"
#   slice_param {
#     axis: 1
#     slice_point: 640
#   }
#   include { phase: TRAIN }
# }



# layer {
#   name: "slice_motion_last_second_3a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3a"
#   top: "second_frame_3a"
#   top: "last_second_frames_3a"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TEST }
# }

# layer {
#   name: "slice_motion_second_3a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3a"
#   top: "second_frames_3a"
#   top: "last_second_frame_3a"
#   slice_param {
#     axis: 1
#     slice_point: 2944
#   }
#   include { phase: TEST }
# }

# layer{
#   name: "silence_first_frame_3a"
#   type: "Silence"
#   bottom: "second_frame_3a"
# }

# layer{
#   name: "silence_last_frame_3a"
#   type: "Silence"
#   bottom: "last_second_frame_3a"
# }

layer{
  name: "silence_first_frame_3a"
  type: "Silence"
  bottom: "first_frame_3a"
}

layer{
  name: "silence_last_frame_3a"
  type: "Silence"
  bottom: "last_frame_3a"
}



layer {
  name: "eltwise_motion_3a"
  type: "Eltwise"
  bottom: "first_frames_3a"
  bottom: "last_frames_3a"
  top: "motion_first_3a"
  eltwise_param {
    operation: SUM
    coeff: -1 
    coeff: 1  # last frames - first frames
  }
}

layer { 
  name: "reshape_motion_first_frames_3a" 
  type: "Reshape" 
  bottom: "motion_first_3a" 
  top: "temporal_grad_3a" 
  reshape_param { shape { dim: [-1, 128, 28, 28] } } 
  # include { phase: TRAIN }
} 




# layer { 
#   name: "reshape_rgb_frames_3a" 
#   type: "Reshape" 
#   bottom: "inception_3a/output" 
#   top: "reshape_spatial_frames_3a" 
#   reshape_param { shape { dim: [16, -1, 28, 28] } } 
#   include { phase: TRAIN }
# } 

# layer { 
#   name: "reshape_rgb_frames_3a" 
#   type: "Reshape" 
#   bottom: "inception_3a/output" 
#   top: "reshape_spatial_frames_3a" 
#   reshape_param { shape { dim: [1, -1, 28, 28] } } 
#   include { phase: TEST }
# } 


layer {
  name: "slice_motion_first_3a"
  type: "Slice"
  bottom: "inception_3a/output"
  top: "spatial_frames_3a"
  top: "spatial_frame_3a"
  slice_param {
    axis: 0
    slice_point: 96  # 16x6
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_3a"
  type: "Slice"
  bottom: "inception_3a/output"
  top: "spatial_frames_3a"
  top: "spatial_frame_3a"
  slice_param {
    axis: 0
    slice_point: 24  # 16x24
  }
  include { phase: TEST }
}

layer{
  name: "silence_last_frame_3a"
  type: "Silence"
  bottom: "spatial_frame_3a"
}


layer {
  name: "reshape_spatial_3a"
  type: "Reshape"
  bottom: "spatial_frames_3a"
  top: "spatial_input_3a"
  reshape_param { shape { dim: [96, -1, 28, 28] } } 
  include { phase: TRAIN }
}

layer {
  name: "reshape_spatial_3a"
  type: "Reshape"
  bottom: "spatial_frames_3a"
  top: "spatial_input_3a"
  reshape_param { shape { dim: [24, -1, 28, 28] } } 
  include { phase: TEST }
}

layer {
  name: "motion_spatial_down_3a"
  type: "Convolution"
  bottom: "spatial_input_3a"
  top: "spatial_down_3a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 1
    # pad: 1
    # group: 32  # equal to num channels
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
    engine: CAFFE
  } 
  #propagate_down: false
}

# layer { 
#   name: "motion_relu_spatial_3a" 
#   type: "ReLU" 
#   bottom: "spatial_down_3a" 
#   top: "spatial_down_3a"
# }


layer {
  name: "motion_spatial_grad_3a"
  type: "Convolution"
  bottom: "spatial_down_3a"
  top: "spatial_3a"
  param { lr_mult: 0 decay_mult: 0 } 
  param { lr_mult: 0 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 3
    pad: 1
    group: 32  # equal to num channels
    weight_filler { type: "sobel" }
    # bias_term: false
    bias_filler { type: "constant" value: 0 } 
    engine: CAFFE
  } 
}

layer { 
  name: "reshape_motion_spatial_3a" 
  type: "Reshape" 
  bottom: "spatial_3a" 
  top: "spatial_grad_3a" 
  reshape_param { shape { dim: [-1, 32, 28, 28] } } 
  # include { phase: TRAIN }
} 

# layer {
#   name: "eltwise_motion_first_3a"
#   type: "Eltwise"
#   bottom: "spatial_3a"
#   bottom: "spatial_down_3a"
#   top: "spatial_grad_3a"
#   eltwise_param {
#     operation: SUM
#     coeff: 1 
#     coeff: 1  # last frames - first frames
#   }
# }

layer { 
  name: "dropout" 
  top: "spatial_grad_3a" 
  bottom: "spatial_grad_3a" 
  type: "Dropout"
  dropout_param { dropout_ratio: 0.8 } 
}

# layer {
#   name: "eltwise_second_motion_3a"
#   type: "Eltwise"
#   bottom: "second_frames_3a"
#   bottom: "last_second_frames_3a"
#   top: "raw_motion_second_3a"
#   eltwise_param {
#     operation: SUM
#     coeff: -1 
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "eltwise_blank_3a"
#   type: "Eltwise"
#   bottom: "first_frame_3a"
#   bottom: "first_frame_3a"
#   top: "blank_3a"
#   eltwise_param {
#     operation: SUM
#     coeff: -1
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "pad_second_3a"
#   type: "Concat"
#   bottom: "raw_motion_second_3a"
#   bottom: "blank_3a"
#   top: "motion_second_3a"
# }

# layer { 
#   name: "reshape_motion_second_frames_3a" 
#   type: "Reshape" 
#   bottom: "motion_second_3a" 
#   top: "reshape_motion_second_frames_3a" 
#   reshape_param { shape { dim: [-1, 128, 28, 28] } } 
#   # include { phase: TRAIN }
# } 


layer{
  name: "concat_first_second_3a"
  type: "Concat"
  bottom: "spatial_grad_3a"
  bottom: "temporal_grad_3a"
  top: "motion_3a"
}





###################################### motion_3b ######################################


layer { 
  name: "motion_conv_gen_3b" 
  type: "Convolution" 
  bottom: "inception_3b/output" 
  top: "motion_conv_gen_3b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}


layer { 
  name: "motion_relu_gen_3b" 
  type: "ReLU" 
  bottom: "motion_conv_gen_3b" 
  top: "motion_conv_gen_3b"
}

layer { 
  name: "reshape_rgb_frames_3b" 
  type: "Reshape" 
  bottom: "motion_conv_gen_3b" 
  top: "reshape_rgb_frames_3b" 
  reshape_param { shape { dim: [16, -1, 28, 28] } } 
  include { phase: TRAIN }
} 

layer { 
  name: "reshape_rgb_frames_3b" 
  type: "Reshape" 
  bottom: "motion_conv_gen_3b" 
  top: "reshape_rgb_frames_3b" 
  reshape_param { shape { dim: [1, -1, 28, 28] } } 
  include { phase: TEST }
} 



layer {
  name: "slice_motion_last_3b"
  type: "Slice"
  bottom: "reshape_rgb_frames_3b"
  top: "first_frame_3b"
  top: "last_frames_3b"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_3b"
  type: "Slice"
  bottom: "reshape_rgb_frames_3b"
  top: "first_frames_3b"
  top: "last_frame_3b"
  slice_param {
    axis: 1
    slice_point: 768# 24*1024
  }
  include { phase: TRAIN }
}


layer {
  name: "slice_motion_last_3b"
  type: "Slice"
  bottom: "reshape_rgb_frames_3b"
  top: "first_frame_3b"
  top: "last_frames_3b"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TEST }
}

layer {
  name: "slice_motion_first_3b"
  type: "Slice"
  bottom: "reshape_rgb_frames_3b"
  top: "first_frames_3b"
  top: "last_frame_3b"
  slice_param {
    axis: 1
    slice_point: 3072 #6144 # 3072# 24*1024
  }
  include { phase: TEST }
}


# layer {
#   name: "slice_motion_last_second_3b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3b"
#   top: "second_frame_3b"
#   top: "last_second_frames_3b"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TRAIN }
# }

# layer {
#   name: "slice_motion_second_3b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3b"
#   top: "second_frames_3b"
#   top: "last_second_frame_3b"
#   slice_param {
#     axis: 1
#     slice_point: 640
#   }
#   include { phase: TRAIN }
# }



# layer {
#   name: "slice_motion_last_second_3b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3b"
#   top: "second_frame_3b"
#   top: "last_second_frames_3b"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TEST }
# }

# layer {
#   name: "slice_motion_second_3b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3b"
#   top: "second_frames_3b"
#   top: "last_second_frame_3b"
#   slice_param {
#     axis: 1
#     slice_point: 2944
#   }
#   include { phase: TEST }
# }

# layer{
#   name: "silence_first_frame_3b"
#   type: "Silence"
#   bottom: "second_frame_3b"
# }

# layer{
#   name: "silence_last_frame_3b"
#   type: "Silence"
#   bottom: "last_second_frame_3b"
# }


layer{
  name: "silence_first_frame_3b"
  type: "Silence"
  bottom: "first_frame_3b"
}

layer{
  name: "silence_last_frame_3b"
  type: "Silence"
  bottom: "last_frame_3b"
}

layer {
  name: "eltwise_motion_first_3b"
  type: "Eltwise"
  bottom: "first_frames_3b"
  bottom: "last_frames_3b"
  top: "motion_first_3b"
  eltwise_param {
    operation: SUM
    coeff: -1 
    coeff: 1  # last frames - first frames
  }
}


layer { 
  name: "reshape_motion_first_frames_3b" 
  type: "Reshape" 
  bottom: "motion_first_3b" 
  top: "temporal_grad_3b" 
  reshape_param { shape { dim: [-1, 128, 28, 28] } } 
  # include { phase: TRAIN }
} 




# layer { 
#   name: "reshape_rgb_frames_3b" 
#   type: "Reshape" 
#   bottom: "inception_3b/output" 
#   top: "reshape_spatial_frames_3b" 
#   reshape_param { shape { dim: [16, -1, 28, 28] } } 
#   include { phase: TRAIN }
# } 

# layer { 
#   name: "reshape_rgb_frames_3b" 
#   type: "Reshape" 
#   bottom: "inception_3b/output" 
#   top: "reshape_spatial_frames_3b" 
#   reshape_param { shape { dim: [1, -1, 28, 28] } } 
#   include { phase: TEST }
# } 


layer {
  name: "slice_motion_first_3b"
  type: "Slice"
  bottom: "inception_3b/output"
  top: "spatial_frames_3b"
  top: "spatial_frame_3b"
  slice_param {
    axis: 0
    slice_point: 96  # 16x6
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_3b"
  type: "Slice"
  bottom: "inception_3b/output"
  top: "spatial_frames_3b"
  top: "spatial_frame_3b"
  slice_param {
    axis: 0
    slice_point: 24  # 16x24
  }
  include { phase: TEST }
}

layer{
  name: "silence_last_frame_3b"
  type: "Silence"
  bottom: "spatial_frame_3b"
}


layer {
  name: "reshape_spatial_3b"
  type: "Reshape"
  bottom: "spatial_frames_3b"
  top: "spatial_input_3b"
  reshape_param { shape { dim: [96, -1, 28, 28] } } 
  include { phase: TRAIN }
}

layer {
  name: "reshape_spatial_3b"
  type: "Reshape"
  bottom: "spatial_frames_3b"
  top: "spatial_input_3b"
  reshape_param { shape { dim: [24, -1, 28, 28] } } 
  include { phase: TEST }
}



layer {
  name: "motion_spatial_down_3b"
  type: "Convolution"
  bottom: "spatial_input_3b"
  top: "spatial_down_3b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 1
    # pad: 1
    # group: 32  # equal to num channels
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
    engine: CAFFE
  } 
  #propagate_down: false
}

# layer { 
#   name: "motion_relu_spatial_3b" 
#   type: "ReLU" 
#   bottom: "spatial_down_3b" 
#   top: "spatial_down_3b"
# }

layer {
  name: "motion_spatial_grad_3b"
  type: "Convolution"
  bottom: "spatial_down_3b"
  top: "spatial_3b"
  param { lr_mult: 0 decay_mult: 0 } 
  param { lr_mult: 0 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 3
    pad: 1
    group: 32  # equal to num channels
    weight_filler { type: "sobel" }
    bias_filler { type: "constant" value: 0 } 
    engine: CAFFE
  } 
}

layer { 
  name: "reshape_motion_spatial_3b" 
  type: "Reshape" 
  bottom: "spatial_3b" 
  top: "spatial_grad_3b" 
  reshape_param { shape { dim: [-1, 32, 28, 28] } } 
  # include { phase: TRAIN }
} 

# layer {
#   name: "eltwise_motion_first_3b"
#   type: "Eltwise"
#   bottom: "spatial_3b"
#   bottom: "spatial_down_3b"
#   top: "spatial_grad_3b"
#   eltwise_param {
#     operation: SUM
#     coeff: 1 
#     coeff: 1  # last frames - first frames
#   }
# }

layer { 
  name: "dropout" 
  top: "spatial_grad_3b" 
  bottom: "spatial_grad_3b" 
  type: "Dropout"
  dropout_param { dropout_ratio: 0.8 } 
}

# layer {
#   name: "eltwise_second_motion_3b"
#   type: "Eltwise"
#   bottom: "second_frames_3b"
#   bottom: "last_second_frames_3b"
#   top: "raw_motion_second_3b"
#   eltwise_param {
#     operation: SUM
#     coeff: -1 
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "eltwise_blank_3b"
#   type: "Eltwise"
#   bottom: "first_frame_3b"
#   bottom: "first_frame_3b"
#   top: "blank_3b"
#   eltwise_param {
#     operation: SUM
#     coeff: -1
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "pad_second_3b"
#   type: "Concat"
#   bottom: "raw_motion_second_3b"
#   bottom: "blank_3b"
#   top: "motion_second_3b"
# }

# layer { 
#   name: "reshape_motion_second_frames_3b" 
#   type: "Reshape" 
#   bottom: "motion_second_3b" 
#   top: "reshape_motion_second_frames_3b" 
#   reshape_param { shape { dim: [-1, 128, 28, 28] } } 
#   # include { phase: TRAIN }
# } 


layer{
  name: "concat_first_second_3b"
  type: "Concat"
  bottom: "spatial_grad_3b"
  bottom: "temporal_grad_3b"
  top: "motion_3b"
}





###################################### motion_3c ######################################

layer { 
  name: "motion_conv_gen_3c" 
  type: "Convolution" 
  bottom: "inception_3c/output" 
  top: "motion_conv_gen_3c"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}


layer { 
  name: "motion_relu_gen_3c" 
  type: "ReLU" 
  bottom: "motion_conv_gen_3c" 
  top: "motion_conv_gen_3c"
}

layer { 
  name: "reshape_rgb_frames_3c" 
  type: "Reshape" 
  bottom: "motion_conv_gen_3c" 
  top: "reshape_rgb_frames_3c" 
  reshape_param { shape { dim: [16, -1, 14, 14] } } 
  include { phase: TRAIN }
} 

layer { 
  name: "reshape_rgb_frames_3c" 
  type: "Reshape" 
  bottom: "motion_conv_gen_3c" 
  top: "reshape_rgb_frames_3c" 
  reshape_param { shape { dim: [1, -1, 14, 14] } } 
  include { phase: TEST }
} 



layer {
  name: "slice_motion_last_3c"
  type: "Slice"
  bottom: "reshape_rgb_frames_3c"
  top: "first_frame_3c"
  top: "last_frames_3c"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_3c"
  type: "Slice"
  bottom: "reshape_rgb_frames_3c"
  top: "first_frames_3c"
  top: "last_frame_3c"
  slice_param {
    axis: 1
    slice_point: 768# 24*1024
  }
  include { phase: TRAIN }
}


layer {
  name: "slice_motion_last_3c"
  type: "Slice"
  bottom: "reshape_rgb_frames_3c"
  top: "first_frame_3c"
  top: "last_frames_3c"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TEST }
}

layer {
  name: "slice_motion_first_3c"
  type: "Slice"
  bottom: "reshape_rgb_frames_3c"
  top: "first_frames_3c"
  top: "last_frame_3c"
  slice_param {
    axis: 1
    slice_point: 3072 #6144 # 3072# 24*1024
  }
  include { phase: TEST }
}



# layer {
#   name: "slice_motion_last_second_3c"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3c"
#   top: "second_frame_3c"
#   top: "last_second_frames_3c"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TRAIN }
# }

# layer {
#   name: "slice_motion_second_3c"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3c"
#   top: "second_frames_3c"
#   top: "last_second_frame_3c"
#   slice_param {
#     axis: 1
#     slice_point: 640
#   }
#   include { phase: TRAIN }
# }



# layer {
#   name: "slice_motion_last_second_3c"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3c"
#   top: "second_frame_3c"
#   top: "last_second_frames_3c"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TEST }
# }

# layer {
#   name: "slice_motion_second_3c"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_3c"
#   top: "second_frames_3c"
#   top: "last_second_frame_3c"
#   slice_param {
#     axis: 1
#     slice_point: 2944
#   }
#   include { phase: TEST }
# }

# layer{
#   name: "silence_first_frame_3c"
#   type: "Silence"
#   bottom: "second_frame_3c"
# }

# layer{
#   name: "silence_last_frame_3c"
#   type: "Silence"
#   bottom: "last_second_frame_3c"
# }

layer{
  name: "silence_first_frame_3c"
  type: "Silence"
  bottom: "first_frame_3c"
}

layer{
  name: "silence_last_frame_3c"
  type: "Silence"
  bottom: "last_frame_3c"
}

layer {
  name: "eltwise_motion_first_3c"
  type: "Eltwise"
  bottom: "first_frames_3c"
  bottom: "last_frames_3c"
  top: "motion_first_3c"
  eltwise_param {
    operation: SUM
    coeff: -1 
    coeff: 1  # last frames - first frames
  }
}


layer { 
  name: "reshape_motion_first_frames_3c" 
  type: "Reshape" 
  bottom: "motion_first_3c" 
  top: "temporal_grad_3c" 
  reshape_param { shape { dim: [-1, 128, 14, 14] } } 
  # include { phase: TRAIN }
} 





# layer { 
#   name: "reshape_rgb_frames_3c" 
#   type: "Reshape" 
#   bottom: "inception_3c/output" 
#   top: "reshape_spatial_frames_3c" 
#   reshape_param { shape { dim: [16, -1, 14, 14] } } 
#   include { phase: TRAIN }
# } 

# layer { 
#   name: "reshape_rgb_frames_3c" 
#   type: "Reshape" 
#   bottom: "inception_3c/output" 
#   top: "reshape_spatial_frames_3c" 
#   reshape_param { shape { dim: [1, -1, 14, 14] } } 
#   include { phase: TEST }
# } 

layer {
  name: "slice_motion_first_3c"
  type: "Slice"
  bottom: "inception_3c/output"
  top: "spatial_frames_3c"
  top: "spatial_frame_3c"
  slice_param {
    axis: 0
    slice_point: 96  # 16x6
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_3c"
  type: "Slice"
  bottom: "inception_3c/output"
  top: "spatial_frames_3c"
  top: "spatial_frame_3c"
  slice_param {
    axis: 0
    slice_point: 24  # 16x24
  }
  include { phase: TEST }
}

layer{
  name: "silence_last_frame_3c"
  type: "Silence"
  bottom: "spatial_frame_3c"
}


layer {
  name: "reshape_spatial_3c"
  type: "Reshape"
  bottom: "spatial_frames_3c"
  top: "spatial_input_3c"
  reshape_param { shape { dim: [96, -1, 14, 14] } } 
  include { phase: TRAIN }
}

layer {
  name: "reshape_spatial_3c"
  type: "Reshape"
  bottom: "spatial_frames_3c"
  top: "spatial_input_3c"
  reshape_param { shape { dim: [24, -1, 14, 14] } } 
  include { phase: TEST }
}
layer {
  name: "motion_spatial_down_3c"
  type: "Convolution"
  bottom: "spatial_input_3c"
  top: "spatial_down_3c"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 1
    # pad: 1
    # group: 32  # equal to num channels
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
    engine: CAFFE
  } 
  #propagate_down: false
}

# layer { 
#   name: "motion_relu_spatial_3c" 
#   type: "ReLU" 
#   bottom: "spatial_down_3c" 
#   top: "spatial_down_3c"
# }


layer {
  name: "motion_spatial_grad_3c"
  type: "Convolution"
  bottom: "spatial_down_3c"
  top: "spatial_3c"
  param { lr_mult: 0 decay_mult: 0 } 
  param { lr_mult: 0 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 3
    pad: 1
    group: 32  # equal to num channels
    weight_filler { type: "sobel" }
    bias_filler { type: "constant" value: 0 } 
    engine: CAFFE
  } 
}

layer { 
  name: "reshape_motion_spatial_3c" 
  type: "Reshape" 
  bottom: "spatial_3c" 
  top: "spatial_grad_3c" 
  reshape_param { shape { dim: [-1, 32, 14, 14] } } 
  # include { phase: TRAIN }
} 

# layer {
#   name: "eltwise_motion_first_3c"
#   type: "Eltwise"
#   bottom: "spatial_3c"
#   bottom: "spatial_down_3c"
#   top: "spatial_grad_3c"
#   eltwise_param {
#     operation: SUM
#     coeff: 1 
#     coeff: 1  # last frames - first frames
#   }
# }

layer { 
  name: "dropout" 
  top: "spatial_grad_3c" 
  bottom: "spatial_grad_3c" 
  type: "Dropout"
  dropout_param { dropout_ratio: 0.8 } 
}

# layer {
#   name: "eltwise_second_motion_3c"
#   type: "Eltwise"
#   bottom: "second_frames_3c"
#   bottom: "last_second_frames_3c"
#   top: "raw_motion_second_3c"
#   eltwise_param {
#     operation: SUM
#     coeff: -1 
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "eltwise_blank_3c"
#   type: "Eltwise"
#   bottom: "first_frame_3c"
#   bottom: "first_frame_3c"
#   top: "blank_3c"
#   eltwise_param {
#     operation: SUM
#     coeff: -1
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "pad_second_3c"
#   type: "Concat"
#   bottom: "raw_motion_second_3c"
#   bottom: "blank_3c"
#   top: "motion_second_3c"
# }

# layer { 
#   name: "reshape_motion_second_frames_3c" 
#   type: "Reshape" 
#   bottom: "motion_second_3c" 
#   top: "reshape_motion_second_frames_3c" 
#   reshape_param { shape { dim: [-1, 128, 14, 14] } } 
#   # include { phase: TRAIN }
# } 


layer{
  name: "concat_first_second_3c"
  type: "Concat"
  bottom: "spatial_grad_3c"
  bottom: "temporal_grad_3c"
  top: "motion_3c"
}





layer {
  name: "motion_fusion_28"
  type: "Concat"
  bottom: "motion_3a"
  bottom: "motion_3b"
  # bottom: "reshape_motion_frames_3c"
  top: "motion_fusion_28"
  concat_param {
    axis: 1
  }
}

# layer { 
#   name: "motion_bn_28" 
#   type: "BN" 
#   bottom: "motion_fusion_28" 
#   top: "motion_bn_28"
#   param { lr_mult: 1 decay_mult: 0 } 
#   param { lr_mult: 1 decay_mult: 0 }
#   bn_param { 
#     frozen: false 
#     slope_filler { type: "constant" value: 1 } 
#     bias_filler { type: "constant" value: 0 }
#   }
# }

# layer { 
#   name: "motion_relu_28" 
#   type: "ReLU" 
#   bottom: "motion_bn_28" 
#   top: "motion_bn_28" 
# }


layer { 
  name: "motion_conv_trans_28" 
  type: "Convolution" 
  bottom: "motion_fusion_28" 
  top: "motion_conv_trans_28"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 64
    kernel_size: 7
    pad: 3
    stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_28" 
  type: "ReLU" 
  bottom: "motion_conv_trans_28" 
  top: "motion_conv_trans_28"
}

layer { 
  name: "motion_conv1_trans_28a" 
  type: "Convolution" 
  bottom: "motion_conv_trans_28" 
  top: "motion_conv1_trans_28a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 64
    kernel_size: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_28a" 
  type: "ReLU" 
  bottom: "motion_conv1_trans_28a" 
  top: "motion_conv1_trans_28a"
}

layer { 
  name: "motion_conv2_trans_28a" 
  type: "Convolution" 
  bottom: "motion_conv1_trans_28a" 
  top: "motion_conv2_trans_28a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 64
    kernel_size: 3
    pad: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_28a" 
  type: "ReLU" 
  bottom: "motion_conv2_trans_28a" 
  top: "motion_conv2_trans_28a"
}

layer { 
  name: "motion_conv3_trans_28a" 
  type: "Convolution" 
  bottom: "motion_conv2_trans_28a" 
  top: "motion_conv3_trans_28a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 256
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_conv_branch_28a" 
  type: "Convolution" 
  bottom: "motion_conv_trans_28" 
  top: "motion_conv_branch_28a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 256
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer {
  name: "motion_sum_28a"
  type: "Eltwise"
  bottom: "motion_conv3_trans_28a"
  bottom: "motion_conv_branch_28a"
  top: "motion_sum_28a"
}

layer { 
  name: "motion_relu_sum_28a" 
  type: "ReLU" 
  bottom: "motion_sum_28a" 
  top: "motion_sum_28a"
}







layer { 
  name: "motion_conv1_trans_28b" 
  type: "Convolution" 
  bottom: "motion_sum_28a" 
  top: "motion_conv1_trans_28b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 64
    kernel_size: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_28b" 
  type: "ReLU" 
  bottom: "motion_conv1_trans_28b" 
  top: "motion_conv1_trans_28b"
}

layer { 
  name: "motion_conv2_trans_28b" 
  type: "Convolution" 
  bottom: "motion_conv1_trans_28b" 
  top: "motion_conv2_trans_28b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 64
    kernel_size: 3
    pad: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_28b" 
  type: "ReLU" 
  bottom: "motion_conv2_trans_28b" 
  top: "motion_conv2_trans_28b"
}

layer { 
  name: "motion_conv3_trans_28b" 
  type: "Convolution" 
  bottom: "motion_conv2_trans_28b" 
  top: "motion_conv3_trans_28b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 256
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}


layer {
  name: "motion_sum_28b"
  type: "Eltwise"
  bottom: "motion_conv3_trans_28b"
  bottom: "motion_sum_28a"
  top: "motion_sum_28b"
}

layer { 
  name: "motion_relu_sum_28b" 
  type: "ReLU" 
  bottom: "motion_sum_28b" 
  top: "motion_sum_28b"
}





layer { 
  name: "motion_conv1_trans_28c" 
  type: "Convolution" 
  bottom: "motion_sum_28b" 
  top: "motion_conv1_trans_28c"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 64
    kernel_size: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_28c" 
  type: "ReLU" 
  bottom: "motion_conv1_trans_28c" 
  top: "motion_conv1_trans_28c"
}

layer { 
  name: "motion_conv2_trans_28c" 
  type: "Convolution" 
  bottom: "motion_conv1_trans_28c" 
  top: "motion_conv2_trans_28c"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 64
    kernel_size: 3
    pad: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_28c" 
  type: "ReLU" 
  bottom: "motion_conv2_trans_28c" 
  top: "motion_conv2_trans_28c"
}

layer { 
  name: "motion_conv3_trans_28c" 
  type: "Convolution" 
  bottom: "motion_conv2_trans_28c" 
  top: "motion_conv3_trans_28c"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 256
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer {
  name: "motion_sum_28c"
  type: "Eltwise"
  bottom: "motion_conv3_trans_28c"
  bottom: "motion_sum_28b"
  top: "motion_sum_28c"
}

layer { 
  name: "motion_relu_sum_28c" 
  type: "ReLU" 
  bottom: "motion_sum_28c" 
  top: "motion_sum_28c"
}








###################################### motion_4a ######################################




layer { 
  name: "motion_conv_gen_4a" 
  type: "Convolution" 
  bottom: "inception_4a/output" 
  top: "motion_conv_gen_4a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128 
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_gen_4a" 
  type: "ReLU" 
  bottom: "motion_conv_gen_4a" 
  top: "motion_conv_gen_4a" 
}

layer { 
  name: "reshape_rgb_frames_4a" 
  type: "Reshape" 
  bottom: "motion_conv_gen_4a" 
  top: "reshape_rgb_frames_4a" 
  reshape_param { shape { dim: [16, -1, 14, 14] } } 
  include { phase: TRAIN }
} 

layer { 
  name: "reshape_rgb_frames_4a" 
  type: "Reshape" 
  bottom: "motion_conv_gen_4a" 
  top: "reshape_rgb_frames_4a" 
  reshape_param { shape { dim: [1, -1, 14, 14] } } 
  include { phase: TEST }
} 



layer {
  name: "slice_motion_last_4a"
  type: "Slice"
  bottom: "reshape_rgb_frames_4a"
  top: "first_frame_4a"
  top: "last_frames_4a"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_4a"
  type: "Slice"
  bottom: "reshape_rgb_frames_4a"
  top: "first_frames_4a"
  top: "last_frame_4a"
  slice_param {
    axis: 1
    slice_point: 768# 24*1024
  }
  include { phase: TRAIN }
}


layer {
  name: "slice_motion_last_4a"
  type: "Slice"
  bottom: "reshape_rgb_frames_4a"
  top: "first_frame_4a"
  top: "last_frames_4a"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TEST }
}

layer {
  name: "slice_motion_first_4a"
  type: "Slice"
  bottom: "reshape_rgb_frames_4a"
  top: "first_frames_4a"
  top: "last_frame_4a"
  slice_param {
    axis: 1
    slice_point: 3072#6144 # 3072# 24*1024
  }
  include { phase: TEST }
}


# layer {
#   name: "slice_motion_last_second_4a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4a"
#   top: "second_frame_4a"
#   top: "last_second_frames_4a"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TRAIN }
# }

# layer {
#   name: "slice_motion_second_4a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4a"
#   top: "second_frames_4a"
#   top: "last_second_frame_4a"
#   slice_param {
#     axis: 1
#     slice_point: 640
#   }
#   include { phase: TRAIN }
# }



# layer {
#   name: "slice_motion_last_second_4a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4a"
#   top: "second_frame_4a"
#   top: "last_second_frames_4a"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TEST }
# }

# layer {
#   name: "slice_motion_second_4a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4a"
#   top: "second_frames_4a"
#   top: "last_second_frame_4a"
#   slice_param {
#     axis: 1
#     slice_point: 2944
#   }
#   include { phase: TEST }
# }

# layer{
#   name: "silence_first_frame_4a"
#   type: "Silence"
#   bottom: "second_frame_4a"
# }

# layer{
#   name: "silence_last_frame_4a"
#   type: "Silence"
#   bottom: "last_second_frame_4a"
# }

layer{
  name: "silence_first_frame_4a"
  type: "Silence"
  bottom: "first_frame_4a"
}

layer{
  name: "silence_last_frame_4a"
  type: "Silence"
  bottom: "last_frame_4a"
}

layer {
  name: "eltwise_motion_first_4a"
  type: "Eltwise"
  bottom: "first_frames_4a"
  bottom: "last_frames_4a"
  top: "motion_first_4a"
  eltwise_param {
    operation: SUM
    coeff: -1 
    coeff: 1  # last frames - first frames
  }
}


layer { 
  name: "reshape_motion_first_frames_4a" 
  type: "Reshape" 
  bottom: "motion_first_4a" 
  top: "temporal_grad_4a" 
  reshape_param { shape { dim: [-1, 128, 14, 14] } } 
  # include { phase: TRAIN }
} 





# layer { 
#   name: "reshape_rgb_frames_4a" 
#   type: "Reshape" 
#   bottom: "inception_4a/output" 
#   top: "reshape_spatial_frames_4a" 
#   reshape_param { shape { dim: [16, -1, 14, 14] } } 
#   include { phase: TRAIN }
# } 

# layer { 
#   name: "reshape_rgb_frames_4a" 
#   type: "Reshape" 
#   bottom: "inception_4a/output" 
#   top: "reshape_spatial_frames_4a" 
#   reshape_param { shape { dim: [1, -1, 14, 14] } } 
#   include { phase: TEST }
# } 

layer {
  name: "slice_motion_first_4a"
  type: "Slice"
  bottom: "inception_4a/output"
  top: "spatial_frames_4a"
  top: "spatial_frame_4a"
  slice_param {
    axis: 0
    slice_point: 96  # 16x6
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_4a"
  type: "Slice"
  bottom: "inception_4a/output"
  top: "spatial_frames_4a"
  top: "spatial_frame_4a"
  slice_param {
    axis: 0
    slice_point: 24  # 16x24
  }
  include { phase: TEST }
}

layer{
  name: "silence_last_frame_4a"
  type: "Silence"
  bottom: "spatial_frame_4a"
}


layer {
  name: "reshape_spatial_4a"
  type: "Reshape"
  bottom: "spatial_frames_4a"
  top: "spatial_input_4a"
  reshape_param { shape { dim: [96, -1, 14, 14] } } 
  include { phase: TRAIN }
}

layer {
  name: "reshape_spatial_4a"
  type: "Reshape"
  bottom: "spatial_frames_4a"
  top: "spatial_input_4a"
  reshape_param { shape { dim: [24, -1, 14, 14] } } 
  include { phase: TEST }
}

layer {
  name: "motion_spatial_down_4a"
  type: "Convolution"
  bottom: "spatial_input_4a"
  top: "spatial_down_4a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 1
    # pad: 1
    # group: 32  # equal to num channels
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
    engine: CAFFE
  } 
  #propagate_down: false
}


# layer { 
#   name: "motion_relu_spatial_4a" 
#   type: "ReLU" 
#   bottom: "spatial_down_4a" 
#   top: "spatial_down_4a"
# }

layer {
  name: "motion_spatial_grad_4a"
  type: "Convolution"
  bottom: "spatial_down_4a"
  top: "spatial_4a"
  param { lr_mult: 0 decay_mult: 0 } 
  param { lr_mult: 0 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 3
    pad: 1
    group: 32  # equal to num channels
    weight_filler { type: "sobel" }
    bias_filler { type: "constant" value: 0 } 
    engine: CAFFE
  } 
}

layer { 
  name: "reshape_motion_spatial_4a" 
  type: "Reshape" 
  bottom: "spatial_4a" 
  top: "spatial_grad_4a" 
  reshape_param { shape { dim: [-1, 32, 14, 14] } } 
  # include { phase: TRAIN }
} 

# layer {
#   name: "eltwise_motion_first_4a"
#   type: "Eltwise"
#   bottom: "spatial_4a"
#   bottom: "spatial_down_4a"
#   top: "spatial_grad_4a"
#   eltwise_param {
#     operation: SUM
#     coeff: 1 
#     coeff: 1  # last frames - first frames
#   }
# }

layer { 
  name: "dropout" 
  top: "spatial_grad_4a" 
  bottom: "spatial_grad_4a" 
  type: "Dropout"
  dropout_param { dropout_ratio: 0.8 } 
}
# layer {
#   name: "eltwise_second_motion_4a"
#   type: "Eltwise"
#   bottom: "second_frames_4a"
#   bottom: "last_second_frames_4a"
#   top: "raw_motion_second_4a"
#   eltwise_param {
#     operation: SUM
#     coeff: -1 
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "eltwise_blank_4a"
#   type: "Eltwise"
#   bottom: "first_frame_4a"
#   bottom: "first_frame_4a"
#   top: "blank_4a"
#   eltwise_param {
#     operation: SUM
#     coeff: -1
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "pad_second_4a"
#   type: "Concat"
#   bottom: "raw_motion_second_4a"
#   bottom: "blank_4a"
#   top: "motion_second_4a"
# }

# layer { 
#   name: "reshape_motion_second_frames_4a" 
#   type: "Reshape" 
#   bottom: "motion_second_4a" 
#   top: "reshape_motion_second_frames_4a" 
#   reshape_param { shape { dim: [-1, 128, 14, 14] } } 
#   # include { phase: TRAIN }
# } 


layer{
  name: "concat_first_second_4a"
  type: "Concat"
  bottom: "spatial_grad_4a"
  bottom: "temporal_grad_4a"
  top: "motion_4a"
}



###################################### motion_4b ######################################


layer { 
  name: "motion_conv_gen_4b" 
  type: "Convolution" 
  bottom: "inception_4b/output" 
  top: "motion_conv_gen_4b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128 
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_gen_4b" 
  type: "ReLU" 
  bottom: "motion_conv_gen_4b" 
  top: "motion_conv_gen_4b" 
}

layer { 
  name: "reshape_rgb_frames_4b" 
  type: "Reshape" 
  bottom: "motion_conv_gen_4b" 
  top: "reshape_rgb_frames_4b" 
  reshape_param { shape { dim: [16, -1, 14, 14] } } 
  include { phase: TRAIN }
} 

layer { 
  name: "reshape_rgb_frames_4b" 
  type: "Reshape" 
  bottom: "motion_conv_gen_4b" 
  top: "reshape_rgb_frames_4b" 
  reshape_param { shape { dim: [1, -1, 14, 14] } } 
  include { phase: TEST }
} 



layer {
  name: "slice_motion_last_4b"
  type: "Slice"
  bottom: "reshape_rgb_frames_4b"
  top: "first_frame_4b"
  top: "last_frames_4b"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_4b"
  type: "Slice"
  bottom: "reshape_rgb_frames_4b"
  top: "first_frames_4b"
  top: "last_frame_4b"
  slice_param {
    axis: 1
    slice_point: 768# 24*1024
  }
  include { phase: TRAIN }
}


layer {
  name: "slice_motion_last_4b"
  type: "Slice"
  bottom: "reshape_rgb_frames_4b"
  top: "first_frame_4b"
  top: "last_frames_4b"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TEST }
}

layer {
  name: "slice_motion_first_4b"
  type: "Slice"
  bottom: "reshape_rgb_frames_4b"
  top: "first_frames_4b"
  top: "last_frame_4b"
  slice_param {
    axis: 1
    slice_point: 3072#6144 # 3072# 24*1024
  }
  include { phase: TEST }
}


# layer {
#   name: "slice_motion_last_second_4b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4b"
#   top: "second_frame_4b"
#   top: "last_second_frames_4b"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TRAIN }
# }

# layer {
#   name: "slice_motion_second_4b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4b"
#   top: "second_frames_4b"
#   top: "last_second_frame_4b"
#   slice_param {
#     axis: 1
#     slice_point: 640
#   }
#   include { phase: TRAIN }
# }



# layer {
#   name: "slice_motion_last_second_4b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4b"
#   top: "second_frame_4b"
#   top: "last_second_frames_4b"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TEST }
# }

# layer {
#   name: "slice_motion_second_4b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4b"
#   top: "second_frames_4b"
#   top: "last_second_frame_4b"
#   slice_param {
#     axis: 1
#     slice_point: 2944
#   }
#   include { phase: TEST }
# }

# layer{
#   name: "silence_first_frame_4b"
#   type: "Silence"
#   bottom: "second_frame_4b"
# }

# layer{
#   name: "silence_last_frame_4b"
#   type: "Silence"
#   bottom: "last_second_frame_4b"
# }

layer{
  name: "silence_first_frame_4b"
  type: "Silence"
  bottom: "first_frame_4b"
}

layer{
  name: "silence_last_frame_4b"
  type: "Silence"
  bottom: "last_frame_4b"
}

layer {
  name: "eltwise_motion_first_4b"
  type: "Eltwise"
  bottom: "first_frames_4b"
  bottom: "last_frames_4b"
  top: "motion_first_4b"
  eltwise_param {
    operation: SUM
    coeff: -1 
    coeff: 1  # last frames - first frames
  }
}


layer { 
  name: "reshape_motion_first_frames_4b" 
  type: "Reshape" 
  bottom: "motion_first_4b" 
  top: "temporal_grad_4b" 
  reshape_param { shape { dim: [-1, 128, 14, 14] } } 
  # include { phase: TRAIN }
} 






# layer { 
#   name: "reshape_rgb_frames_4b" 
#   type: "Reshape" 
#   bottom: "inception_4b/output" 
#   top: "reshape_saptial_frames_4b" 
#   reshape_param { shape { dim: [16, -1, 14, 14] } } 
#   include { phase: TRAIN }
# } 

# layer { 
#   name: "reshape_rgb_frames_4b" 
#   type: "Reshape" 
#   bottom: "inception_4b/output" 
#   top: "reshape_saptial_frames_4b" 
#   reshape_param { shape { dim: [1, -1, 14, 14] } } 
#   include { phase: TEST }
# } 

layer {
  name: "slice_motion_first_4b"
  type: "Slice"
  bottom: "inception_4b/output"
  top: "spatial_frames_4b"
  top: "spatial_frame_4b"
  slice_param {
    axis: 0
    slice_point: 96  # 16x6
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_4b"
  type: "Slice"
  bottom: "inception_4b/output"
  top: "spatial_frames_4b"
  top: "spatial_frame_4b"
  slice_param {
    axis: 0
    slice_point: 24  # 16x24
  }
  include { phase: TEST }
}

layer{
  name: "silence_last_frame_4b"
  type: "Silence"
  bottom: "spatial_frame_4b"
}


layer {
  name: "reshape_spatial_4b"
  type: "Reshape"
  bottom: "spatial_frames_4b"
  top: "spatial_input_4b"
  reshape_param { shape { dim: [96, -1, 14, 14] } } 
  include { phase: TRAIN }
}

layer {
  name: "reshape_spatial_4b"
  type: "Reshape"
  bottom: "spatial_frames_4b"
  top: "spatial_input_4b"
  reshape_param { shape { dim: [24, -1, 14, 14] } } 
  include { phase: TEST }
}

layer {
  name: "motion_spatial_down_4b"
  type: "Convolution"
  bottom: "spatial_input_4b"
  top: "spatial_down_4b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 1
    # pad: 1
    # group: 32  # equal to num channels
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
    engine: CAFFE
  } 
  #propagate_down: false
}

# layer { 
#   name: "motion_relu_spatial_4b" 
#   type: "ReLU" 
#   bottom: "spatial_down_4b" 
#   top: "spatial_down_4b"
# }

layer {
  name: "motion_spatial_grad_4b"
  type: "Convolution"
  bottom: "spatial_down_4b"
  top: "spatial_4b"
  param { lr_mult: 0 decay_mult: 0 } 
  param { lr_mult: 0 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 3
    pad: 1
    group: 32  # equal to num channels
    weight_filler { type: "sobel" }
    bias_filler { type: "constant" value: 0 } 
    engine: CAFFE
  } 
}

layer { 
  name: "reshape_motion_spatial_4b" 
  type: "Reshape" 
  bottom: "spatial_4b" 
  top: "spatial_grad_4b" 
  reshape_param { shape { dim: [-1, 32, 14, 14] } } 
  # include { phase: TRAIN }
} 

# layer {
#   name: "eltwise_motion_first_4b"
#   type: "Eltwise"
#   bottom: "spatial_4b"
#   bottom: "spatial_down_4b"
#   top: "spatial_grad_4b"
#   eltwise_param {
#     operation: SUM
#     coeff: 1 
#     coeff: 1  # last frames - first frames
#   }
# }

layer { 
  name: "dropout" 
  top: "spatial_grad_4b" 
  bottom: "spatial_grad_4b" 
  type: "Dropout"
  dropout_param { dropout_ratio: 0.8 } 
}
# layer {
#   name: "eltwise_second_motion_4b"
#   type: "Eltwise"
#   bottom: "second_frames_4b"
#   bottom: "last_second_frames_4b"
#   top: "raw_motion_second_4b"
#   eltwise_param {
#     operation: SUM
#     coeff: -1 
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "eltwise_blank_4b"
#   type: "Eltwise"
#   bottom: "first_frame_4b"
#   bottom: "first_frame_4b"
#   top: "blank_4b"
#   eltwise_param {
#     operation: SUM
#     coeff: -1
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "pad_second_4b"
#   type: "Concat"
#   bottom: "raw_motion_second_4b"
#   bottom: "blank_4b"
#   top: "motion_second_4b"
# }

# layer { 
#   name: "reshape_motion_second_frames_4b" 
#   type: "Reshape" 
#   bottom: "motion_second_4b" 
#   top: "reshape_motion_second_frames_4b" 
#   reshape_param { shape { dim: [-1, 128, 14, 14] } } 
#   # include { phase: TRAIN }
# } 


layer{
  name: "concat_first_second_4b"
  type: "Concat"
  bottom: "spatial_grad_4b"
  bottom: "temporal_grad_4b"
  top: "motion_4b"
}




###################################### motion_4c ######################################




layer { 
  name: "motion_conv_gen_4c" 
  type: "Convolution" 
  bottom: "inception_4c/output" 
  top: "motion_conv_gen_4c"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128 
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_gen_4c" 
  type: "ReLU" 
  bottom: "motion_conv_gen_4c" 
  top: "motion_conv_gen_4c" 
}

layer { 
  name: "reshape_rgb_frames_4c" 
  type: "Reshape" 
  bottom: "motion_conv_gen_4c" 
  top: "reshape_rgb_frames_4c" 
  reshape_param { shape { dim: [16, -1, 14, 14] } } 
  include { phase: TRAIN }
} 

layer { 
  name: "reshape_rgb_frames_4c" 
  type: "Reshape" 
  bottom: "motion_conv_gen_4c" 
  top: "reshape_rgb_frames_4c" 
  reshape_param { shape { dim: [1, -1, 14, 14] } } 
  include { phase: TEST }
} 



layer {
  name: "slice_motion_last_4c"
  type: "Slice"
  bottom: "reshape_rgb_frames_4c"
  top: "first_frame_4c"
  top: "last_frames_4c"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_4c"
  type: "Slice"
  bottom: "reshape_rgb_frames_4c"
  top: "first_frames_4c"
  top: "last_frame_4c"
  slice_param {
    axis: 1
    slice_point: 768# 24*1024
  }
  include { phase: TRAIN }
}


layer {
  name: "slice_motion_last_4c"
  type: "Slice"
  bottom: "reshape_rgb_frames_4c"
  top: "first_frame_4c"
  top: "last_frames_4c"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TEST }
}

layer {
  name: "slice_motion_first_4c"
  type: "Slice"
  bottom: "reshape_rgb_frames_4c"
  top: "first_frames_4c"
  top: "last_frame_4c"
  slice_param {
    axis: 1
    slice_point: 3072#6144 # 3072# 24*1024
  }
  include { phase: TEST }
}


# layer {
#   name: "slice_motion_last_second_4c"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4c"
#   top: "second_frame_4c"
#   top: "last_second_frames_4c"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TRAIN }
# }

# layer {
#   name: "slice_motion_second_4c"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4c"
#   top: "second_frames_4c"
#   top: "last_second_frame_4c"
#   slice_param {
#     axis: 1
#     slice_point: 640
#   }
#   include { phase: TRAIN }
# }



# layer {
#   name: "slice_motion_last_second_4c"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4c"
#   top: "second_frame_4c"
#   top: "last_second_frames_4c"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TEST }
# }

# layer {
#   name: "slice_motion_second_4c"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4c"
#   top: "second_frames_4c"
#   top: "last_second_frame_4c"
#   slice_param {
#     axis: 1
#     slice_point: 2944
#   }
#   include { phase: TEST }
# }

# layer{
#   name: "silence_first_frame_4c"
#   type: "Silence"
#   bottom: "second_frame_4c"
# }

# layer{
#   name: "silence_last_frame_4c"
#   type: "Silence"
#   bottom: "last_second_frame_4c"
# }

layer{
  name: "silence_first_frame_4c"
  type: "Silence"
  bottom: "first_frame_4c"
}

layer{
  name: "silence_last_frame_4c"
  type: "Silence"
  bottom: "last_frame_4c"
}

layer {
  name: "eltwise_motion_first_4c"
  type: "Eltwise"
  bottom: "first_frames_4c"
  bottom: "last_frames_4c"
  top: "motion_first_4c"
  eltwise_param {
    operation: SUM
    coeff: -1 
    coeff: 1  # last frames - first frames
  }
}


layer { 
  name: "reshape_motion_first_frames_4c" 
  type: "Reshape" 
  bottom: "motion_first_4c" 
  top: "temporal_grad_4c" 
  reshape_param { shape { dim: [-1, 128, 14, 14] } } 
  # include { phase: TRAIN }
} 


layer {
  name: "slice_motion_first_4c"
  type: "Slice"
  bottom: "inception_4c/output"
  top: "spatial_frames_4c"
  top: "spatial_frame_4c"
  slice_param {
    axis: 0
    slice_point: 96  # 16x6
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_4c"
  type: "Slice"
  bottom: "inception_4c/output"
  top: "spatial_frames_4c"
  top: "spatial_frame_4c"
  slice_param {
    axis: 0
    slice_point: 24  # 16x24
  }
  include { phase: TEST }
}

layer{
  name: "silence_last_frame_4c"
  type: "Silence"
  bottom: "spatial_frame_4c"
}


layer {
  name: "reshape_spatial_4c"
  type: "Reshape"
  bottom: "spatial_frames_4c"
  top: "spatial_input_4c"
  reshape_param { shape { dim: [96, -1, 14, 14] } } 
  include { phase: TRAIN }
}

layer {
  name: "reshape_spatial_4c"
  type: "Reshape"
  bottom: "spatial_frames_4c"
  top: "spatial_input_4c"
  reshape_param { shape { dim: [24, -1, 14, 14] } } 
  include { phase: TEST }
}

layer {
  name: "motion_spatial_down_4c"
  type: "Convolution"
  bottom: "spatial_input_4c"
  top: "spatial_down_4c"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 1
    # pad: 1
    # group: 32  # equal to num channels
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
    engine: CAFFE
  } 
  #propagate_down: false
}

# layer { 
#   name: "motion_relu_spatial_4c" 
#   type: "ReLU" 
#   bottom: "spatial_down_4c" 
#   top: "spatial_down_4c"
# }


layer {
  name: "motion_spatial_grad_4c"
  type: "Convolution"
  bottom: "spatial_down_4c"
  top: "spatial_4c"
  param { lr_mult: 0 decay_mult: 0 } 
  param { lr_mult: 0 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 3
    pad: 1
    group: 32  # equal to num channels
    weight_filler { type: "sobel" }
    bias_filler { type: "constant" value: 0 } 
    engine: CAFFE
  } 
}

layer { 
  name: "reshape_motion_spatial_4c" 
  type: "Reshape" 
  bottom: "spatial_4c" 
  top: "spatial_grad_4c" 
  reshape_param { shape { dim: [-1, 32, 14, 14] } } 
  # include { phase: TRAIN }
} 

# layer {
#   name: "eltwise_motion_first_4c"
#   type: "Eltwise"
#   bottom: "spatial_4c"
#   bottom: "spatial_down_4c"
#   top: "spatial_grad_4c"
#   eltwise_param {
#     operation: SUM
#     coeff: 1 
#     coeff: 1  # last frames - first frames
#   }
# }

layer { 
  name: "dropout" 
  top: "spatial_grad_4c" 
  bottom: "spatial_grad_4c" 
  type: "Dropout"
  dropout_param { dropout_ratio: 0.8 } 
}



layer{
  name: "concat_first_second_4c"
  type: "Concat"
  bottom: "spatial_grad_4c"
  bottom: "temporal_grad_4c"
  top: "motion_4c"
}




###################################### motion_4d ######################################



layer { 
  name: "motion_conv_gen_4d" 
  type: "Convolution" 
  bottom: "inception_4d/output" 
  top: "motion_conv_gen_4d"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128 
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_gen_4d" 
  type: "ReLU" 
  bottom: "motion_conv_gen_4d" 
  top: "motion_conv_gen_4d" 
}

layer { 
  name: "reshape_rgb_frames_4d" 
  type: "Reshape" 
  bottom: "motion_conv_gen_4d" 
  top: "reshape_rgb_frames_4d" 
  reshape_param { shape { dim: [16, -1, 14, 14] } } 
  include { phase: TRAIN }
} 

layer { 
  name: "reshape_rgb_frames_4d" 
  type: "Reshape" 
  bottom: "motion_conv_gen_4d" 
  top: "reshape_rgb_frames_4d" 
  reshape_param { shape { dim: [1, -1, 14, 14] } } 
  include { phase: TEST }
} 



layer {
  name: "slice_motion_last_4d"
  type: "Slice"
  bottom: "reshape_rgb_frames_4d"
  top: "first_frame_4d"
  top: "last_frames_4d"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_4d"
  type: "Slice"
  bottom: "reshape_rgb_frames_4d"
  top: "first_frames_4d"
  top: "last_frame_4d"
  slice_param {
    axis: 1
    slice_point: 768# 24*1024
  }
  include { phase: TRAIN }
}


layer {
  name: "slice_motion_last_4d"
  type: "Slice"
  bottom: "reshape_rgb_frames_4d"
  top: "first_frame_4d"
  top: "last_frames_4d"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TEST }
}

layer {
  name: "slice_motion_first_4d"
  type: "Slice"
  bottom: "reshape_rgb_frames_4d"
  top: "first_frames_4d"
  top: "last_frame_4d"
  slice_param {
    axis: 1
    slice_point: 3072#6144 # 3072# 24*1024
  }
  include { phase: TEST }
}


# layer {
#   name: "slice_motion_last_second_4d"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4d"
#   top: "second_frame_4d"
#   top: "last_second_frames_4d"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TRAIN }
# }

# layer {
#   name: "slice_motion_second_4d"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4d"
#   top: "second_frames_4d"
#   top: "last_second_frame_4d"
#   slice_param {
#     axis: 1
#     slice_point: 640
#   }
#   include { phase: TRAIN }
# }



# layer {
#   name: "slice_motion_last_second_4d"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4d"
#   top: "second_frame_4d"
#   top: "last_second_frames_4d"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TEST }
# }

# layer {
#   name: "slice_motion_second_4d"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_4d"
#   top: "second_frames_4d"
#   top: "last_second_frame_4d"
#   slice_param {
#     axis: 1
#     slice_point: 2944
#   }
#   include { phase: TEST }
# }

# layer{
#   name: "silence_first_frame_4d"
#   type: "Silence"
#   bottom: "second_frame_4d"
# }

# layer{
#   name: "silence_last_frame_4d"
#   type: "Silence"
#   bottom: "last_second_frame_4d"
# }

layer{
  name: "silence_first_frame_4d"
  type: "Silence"
  bottom: "first_frame_4d"
}

layer{
  name: "silence_last_frame_4d"
  type: "Silence"
  bottom: "last_frame_4d"
}


layer {
  name: "eltwise_motion_first_4d"
  type: "Eltwise"
  bottom: "first_frames_4d"
  bottom: "last_frames_4d"
  top: "motion_first_4d"
  eltwise_param {
    operation: SUM
    coeff: -1 
    coeff: 1  # last frames - first frames
  }
}


layer { 
  name: "reshape_motion_first_frames_4d" 
  type: "Reshape" 
  bottom: "motion_first_4d" 
  top: "temporal_grad_4d" 
  reshape_param { shape { dim: [-1, 128, 14, 14] } } 
  # include { phase: TRAIN }
} 



# layer { 
#   name: "reshape_rgb_frames_4d" 
#   type: "Reshape" 
#   bottom: "inception_4d/output" 
#   top: "reshape_spatial_frames_4d" 
#   reshape_param { shape { dim: [16, -1, 14, 14] } } 
#   include { phase: TRAIN }
# } 

# layer { 
#   name: "reshape_rgb_frames_4d" 
#   type: "Reshape" 
#   bottom: "inception_4d/output" 
#   top: "reshape_spatial_frames_4d" 
#   reshape_param { shape { dim: [1, -1, 14, 14] } } 
#   include { phase: TEST }
# } 

layer {
  name: "slice_motion_first_4d"
  type: "Slice"
  bottom: "inception_4d/output"
  top: "spatial_frames_4d"
  top: "spatial_frame_4d"
  slice_param {
    axis: 0
    slice_point: 96  # 16x6
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_4d"
  type: "Slice"
  bottom: "inception_4d/output"
  top: "spatial_frames_4d"
  top: "spatial_frame_4d"
  slice_param {
    axis: 0
    slice_point: 24  # 16x24
  }
  include { phase: TEST }
}

layer{
  name: "silence_last_frame_4d"
  type: "Silence"
  bottom: "spatial_frame_4d"
}


layer {
  name: "reshape_spatial_4d"
  type: "Reshape"
  bottom: "spatial_frames_4d"
  top: "spatial_input_4d"
  reshape_param { shape { dim: [96, -1, 14, 14] } } 
  include { phase: TRAIN }
}

layer {
  name: "reshape_spatial_4d"
  type: "Reshape"
  bottom: "spatial_frames_4d"
  top: "spatial_input_4d"
  reshape_param { shape { dim: [24, -1, 14, 14] } } 
  include { phase: TEST }
}

layer {
  name: "motion_spatial_down_4d"
  type: "Convolution"
  bottom: "spatial_input_4d"
  top: "spatial_down_4d"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 1
    # pad: 1
    # group: 32  # equal to num channels
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
    engine: CAFFE
  } 
  #propagate_down: false
}

# layer { 
#   name: "motion_relu_spatial_4d" 
#   type: "ReLU" 
#   bottom: "spatial_down_4d" 
#   top: "spatial_down_4d"
# }

layer {
  name: "motion_spatial_grad_4d"
  type: "Convolution"
  bottom: "spatial_down_4d"
  top: "spatial_4d"
  param { lr_mult: 0 decay_mult: 0 } 
  param { lr_mult: 0 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 3
    pad: 1
    group: 32  # equal to num channels
    weight_filler { type: "sobel" }
    bias_filler { type: "constant" value: 0 } 
    engine: CAFFE
  } 
}

layer { 
  name: "reshape_motion_spatial_4d" 
  type: "Reshape" 
  bottom: "spatial_4d" 
  top: "spatial_grad_4d" 
  reshape_param { shape { dim: [-1, 32, 14, 14] } } 
  # include { phase: TRAIN }
} 

# layer {
#   name: "eltwise_motion_first_4d"
#   type: "Eltwise"
#   bottom: "spatial_4d"
#   bottom: "spatial_down_4d"
#   top: "spatial_grad_4d"
#   eltwise_param {
#     operation: SUM
#     coeff: 1 
#     coeff: 1  # last frames - first frames
#   }
# }

layer { 
  name: "dropout" 
  top: "spatial_grad_4d" 
  bottom: "spatial_grad_4d" 
  type: "Dropout"
  dropout_param { dropout_ratio: 0.8 } 
}

# layer {
#   name: "eltwise_second_motion_4d"
#   type: "Eltwise"
#   bottom: "second_frames_4d"
#   bottom: "last_second_frames_4d"
#   top: "raw_motion_second_4d"
#   eltwise_param {
#     operation: SUM
#     coeff: -1 
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "eltwise_blank_4d"
#   type: "Eltwise"
#   bottom: "first_frame_4d"
#   bottom: "first_frame_4d"
#   top: "blank_4d"
#   eltwise_param {
#     operation: SUM
#     coeff: -1
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "pad_second_4d"
#   type: "Concat"
#   bottom: "raw_motion_second_4d"
#   bottom: "blank_4d"
#   top: "motion_second_4d"
# }

# layer { 
#   name: "reshape_motion_second_frames_4d" 
#   type: "Reshape" 
#   bottom: "motion_second_4d" 
#   top: "reshape_motion_second_frames_4d" 
#   reshape_param { shape { dim: [-1, 128, 14, 14] } } 
#   # include { phase: TRAIN }
# } 


layer{
  name: "concat_first_second_4d"
  type: "Concat"
  bottom: "spatial_grad_4d"
  bottom: "temporal_grad_4d"
  top: "motion_4d"
}



####################################### Fusion 3a & 3b #######################################


####################################### Fusion 4b & 4d #######################################


layer {
  name: "motion_fusion_14"
  type: "Concat"
  bottom: "motion_3c"
  bottom: "motion_4a"
  bottom: "motion_4b"
  bottom: "motion_4c"
  bottom: "motion_4d"
  bottom: "motion_sum_28c"
  top: "motion_fusion_14"
  concat_param {
    axis: 1
  }
}

layer { 
  name: "motion_conv_trans_14" 
  type: "Convolution" 
  bottom: "motion_fusion_14" 
  top: "motion_conv_trans_14"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128
    kernel_size: 5
    pad: 2
    stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_14" 
  type: "ReLU" 
  bottom: "motion_conv_trans_14" 
  top: "motion_conv_trans_14"
}

# layer { 
#   name: "motion_scale_14" 
#   type: "Scale" 
#   bottom: "motion_conv_trans_14" 
#   top: "motion_scale_14"
#   param { lr_mult: 1 decay_mult: 0 } 
#   param { lr_mult: 1 decay_mult: 0 }
#   scale_param { 
#     filler { type: "msra" } 
#     bias_term: true     
#     bias_filler { type: "constant" value: 0.2 }
#   } 
# }


# layer { 
#   name: "motion_relu_14" 
#   type: "ReLU" 
#   bottom: "motion_scale_14" 
#   top: "motion_scale_14" 
# }



layer { 
  name: "motion_conv1_trans_14a" 
  type: "Convolution" 
  bottom: "motion_conv_trans_14" 
  top: "motion_conv1_trans_14a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128
    kernel_size: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_14a" 
  type: "ReLU" 
  bottom: "motion_conv1_trans_14a" 
  top: "motion_conv1_trans_14a"
}

layer { 
  name: "motion_conv2_trans_14a" 
  type: "Convolution" 
  bottom: "motion_conv1_trans_14a" 
  top: "motion_conv2_trans_14a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128
    kernel_size: 3
    pad: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_14a" 
  type: "ReLU" 
  bottom: "motion_conv2_trans_14a" 
  top: "motion_conv2_trans_14a"
}

layer { 
  name: "motion_conv3_trans_14a" 
  type: "Convolution" 
  bottom: "motion_conv2_trans_14a" 
  top: "motion_conv3_trans_14a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 512
    kernel_size: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_conv_expand_trans_14a" 
  type: "Convolution" 
  bottom: "motion_conv_trans_14" 
  top: "motion_conv_expand_trans_14a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 512
    kernel_size: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer {
  name: "motion_sum_14a"
  type: "Eltwise"
  bottom: "motion_conv3_trans_14a"
  bottom: "motion_conv_expand_trans_14a"
  top: "motion_sum_14a"
}

layer { 
  name: "motion_relu_sum_14a" 
  type: "ReLU" 
  bottom: "motion_sum_14a" 
  top: "motion_sum_14a"
}



layer { 
  name: "motion_conv1_trans_14b" 
  type: "Convolution" 
  bottom: "motion_sum_14a" 
  top: "motion_conv1_trans_14b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128
    kernel_size: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_14b" 
  type: "ReLU" 
  bottom: "motion_conv1_trans_14b" 
  top: "motion_conv1_trans_14b"
}

layer { 
  name: "motion_conv2_trans_14b" 
  type: "Convolution" 
  bottom: "motion_conv1_trans_14b" 
  top: "motion_conv2_trans_14b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128
    kernel_size: 3
    pad: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans_14b" 
  type: "ReLU" 
  bottom: "motion_conv2_trans_14b" 
  top: "motion_conv2_trans_14b"
}

layer { 
  name: "motion_conv3_trans_14b" 
  type: "Convolution" 
  bottom: "motion_conv2_trans_14b" 
  top: "motion_conv3_trans_14b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 512
    kernel_size: 3
    pad: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

# layer { 
#   name: "motion_conv_expand_trans_14b" 
#   type: "Convolution" 
#   bottom: "motion_sum_14a" 
#   top: "motion_conv_expand_trans_14b"
#   param { lr_mult: 1 decay_mult: 1 } 
#   param { lr_mult: 2 decay_mult: 0 }
#   convolution_param { 
#     num_output: 256
#     kernel_size: 3
#     pad: 1
#     # stride: 2
#     weight_filler { type: "msra" }
#     bias_filler { type: "constant" value: 0.2 } 
#   } 
# }

layer {
  name: "motion_sum_14b"
  type: "Eltwise"
  bottom: "motion_conv3_trans_14b"
  bottom: "motion_sum_14a"
  top: "motion_sum_14b"
}

layer { 
  name: "motion_relu_sum_14b" 
  type: "ReLU" 
  bottom: "motion_sum_14b" 
  top: "motion_sum_14b"
}


# layer { 
#   name: "motion_pool_trans_14" 
#   type: "Pooling" 
#   bottom: "motion_sum_14" 
#   top: "motion_pool_trans_14"
#   pooling_param { pool: MAX kernel_size: 3 stride: 2 } 
# }








#######################################  FC & Loss & Accuracy 28 #######################################


# layer { 
#   name: "motion_conv_to_fc_28" 
#   type: "Convolution" 
#   bottom: "motion_fusion_28" 
#   top: "motion_conv_to_fc_28"
#   param { lr_mult: 1 decay_mult: 1 } 
#   param { lr_mult: 2 decay_mult: 0 }
#   convolution_param { 
#     num_output: 256 
#     kernel_size: 3
#     pad: 1
#     stride: 2
#     weight_filler { type: "msra" }
#     bias_filler { type: "constant" value: 0.2 } 
#   } 
# }

layer { 
  name: "motion_pool_trans_28" 
  type: "Pooling" 
  bottom: "motion_sum_28c" 
  top: "motion_pool_trans_28"
  pooling_param { pool: MAX kernel_size: 3 stride: 2 } 
}


layer { 
  name: "global_pool_motion_28" 
  type: "Pooling"
  top: "global_pool_motion_28" 
  bottom: "motion_pool_trans_28" 
  pooling_param { pool: AVE kernel_size: 7 stride: 1 } 
}

layer { 
  name: "dropout_motion_28" 
  type: "Dropout"
  top: "global_pool_motion_28" 
  bottom: "global_pool_motion_28" 
  dropout_param { dropout_ratio: 0.8 } 
}


layer { name: "fc-action-motion_28" type: "InnerProduct" bottom: "global_pool_motion_28" top: "fc_motion_28"
  param { lr_mult: 1 decay_mult: 1 } param { lr_mult: 2 decay_mult: 0 }
  inner_product_param { 
    num_output: 101
    weight_filler { type: "gaussian" std: 0.001 }
    bias_filler { type: "constant" value: 0 } 
  }
}




#######################################  FC & Loss & Accuracy 14 #######################################


layer { 
  name: "global_pool_motion_14" 
  type: "Pooling"
  top: "global_pool_motion_14" 
  bottom: "motion_sum_14b" 
  pooling_param { pool: AVE kernel_size: 7 stride: 1 } 
}

layer { 
  name: "dropout_motion_14" 
  type: "Dropout"
  top: "global_pool_motion_14" 
  bottom: "global_pool_motion_14" 
  dropout_param { dropout_ratio: 0.8 } 
}


layer { name: "fc-action-motion_14" type: "InnerProduct" bottom: "global_pool_motion_14" top: "fc_motion_14"
  param { lr_mult: 1 decay_mult: 1 } param { lr_mult: 2 decay_mult: 0 }
  inner_product_param { 
    num_output: 101
    weight_filler { type: "gaussian" std: 0.001 }
    bias_filler { type: "constant" value: 0 } 
  }
}




#######################################  FC & Loss & Accuracy Motion #######################################

###################################### motion_5a ######################################




layer { 
  name: "motion_conv_gen_5a" 
  type: "Convolution" 
  bottom: "inception_5a/output" 
  top: "motion_conv_gen_5a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128 
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_gen_5a" 
  type: "ReLU" 
  bottom: "motion_conv_gen_5a" 
  top: "motion_conv_gen_5a" 
}

layer { 
  name: "reshape_rgb_frames_5a" 
  type: "Reshape" 
  bottom: "motion_conv_gen_5a" 
  top: "reshape_rgb_frames_5a" 
  reshape_param { shape { dim: [16, -1, 7, 7] } } 
  include { phase: TRAIN }
} 

layer { 
  name: "reshape_rgb_frames_5a" 
  type: "Reshape" 
  bottom: "motion_conv_gen_5a" 
  top: "reshape_rgb_frames_5a" 
  reshape_param { shape { dim: [1, -1, 7, 7] } } 
  include { phase: TEST }
} 



layer {
  name: "slice_motion_last_5a"
  type: "Slice"
  bottom: "reshape_rgb_frames_5a"
  top: "first_frame_5a"
  top: "last_frames_5a"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_5a"
  type: "Slice"
  bottom: "reshape_rgb_frames_5a"
  top: "first_frames_5a"
  top: "last_frame_5a"
  slice_param {
    axis: 1
    slice_point: 768# 24*1024
  }
  include { phase: TRAIN }
}


layer {
  name: "slice_motion_last_5a"
  type: "Slice"
  bottom: "reshape_rgb_frames_5a"
  top: "first_frame_5a"
  top: "last_frames_5a"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TEST }
}

layer {
  name: "slice_motion_first_5a"
  type: "Slice"
  bottom: "reshape_rgb_frames_5a"
  top: "first_frames_5a"
  top: "last_frame_5a"
  slice_param {
    axis: 1
    slice_point: 3072#6144 # 3072# 24*1024
  }
  include { phase: TEST }
}


# layer {
#   name: "slice_motion_last_second_5a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_5a"
#   top: "second_frame_5a"
#   top: "last_second_frames_5a"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TRAIN }
# }

# layer {
#   name: "slice_motion_second_5a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_5a"
#   top: "second_frames_5a"
#   top: "last_second_frame_5a"
#   slice_param {
#     axis: 1
#     slice_point: 640
#   }
#   include { phase: TRAIN }
# }



# layer {
#   name: "slice_motion_last_second_5a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_5a"
#   top: "second_frame_5a"
#   top: "last_second_frames_5a"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TEST }
# }

# layer {
#   name: "slice_motion_second_5a"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_5a"
#   top: "second_frames_5a"
#   top: "last_second_frame_5a"
#   slice_param {
#     axis: 1
#     slice_point: 2944
#   }
#   include { phase: TEST }
# }

# layer{
#   name: "silence_first_frame_5a"
#   type: "Silence"
#   bottom: "second_frame_5a"
# }

# layer{
#   name: "silence_last_frame_5a"
#   type: "Silence"
#   bottom: "last_second_frame_5a"
# }
layer{
  name: "silence_first_frame_5a"
  type: "Silence"
  bottom: "first_frame_5a"
}

layer{
  name: "silence_last_frame_5a"
  type: "Silence"
  bottom: "last_frame_5a"
}

layer {
  name: "eltwise_motion_first_5a"
  type: "Eltwise"
  bottom: "first_frames_5a"
  bottom: "last_frames_5a"
  top: "motion_first_5a"
  eltwise_param {
    operation: SUM
    coeff: -1 
    coeff: 1  # last frames - first frames
  }
}


layer { 
  name: "reshape_motion_first_frames_5a" 
  type: "Reshape" 
  bottom: "motion_first_5a" 
  top: "temporal_grad_5a" 
  reshape_param { shape { dim: [-1, 128, 7, 7] } } 
  # include { phase: TRAIN }
} 


# layer { 
#   name: "reshape_rgb_frames_5a" 
#   type: "Reshape" 
#   bottom: "inception_5a/output" 
#   top: "reshape_spatial_frames_5a" 
#   reshape_param { shape { dim: [16, -1, 7, 7] } } 
#   include { phase: TRAIN }
# } 

# layer { 
#   name: "reshape_rgb_frames_5a" 
#   type: "Reshape" 
#   bottom: "inception_5a/output" 
#   top: "reshape_spatial_frames_5a" 
#   reshape_param { shape { dim: [1, -1, 7, 7] } } 
#   include { phase: TEST }
# } 

layer {
  name: "slice_motion_first_5a"
  type: "Slice"
  bottom: "inception_5a/output"
  top: "spatial_frames_5a"
  top: "spatial_frame_5a"
  slice_param {
    axis: 0
    slice_point: 96  # 16x6
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_5a"
  type: "Slice"
  bottom: "inception_5a/output"
  top: "spatial_frames_5a"
  top: "spatial_frame_5a"
  slice_param {
    axis: 0
    slice_point: 24  # 16x24
  }
  include { phase: TEST }
}

layer{
  name: "silence_last_frame_5a"
  type: "Silence"
  bottom: "spatial_frame_5a"
}


layer {
  name: "reshape_spatial_5a"
  type: "Reshape"
  bottom: "spatial_frames_5a"
  top: "spatial_input_5a"
  reshape_param { shape { dim: [96, -1, 7, 7] } } 
  include { phase: TRAIN }
}

layer {
  name: "reshape_spatial_5a"
  type: "Reshape"
  bottom: "spatial_frames_5a"
  top: "spatial_input_5a"
  reshape_param { shape { dim: [24, -1, 7, 7] } } 
  include { phase: TEST }
}

layer {
  name: "motion_spatial_down_5a"
  type: "Convolution"
  bottom: "spatial_input_5a"
  top: "spatial_down_5a"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 1
    # pad: 1
    # group: 32  # equal to num channels
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
    engine: CAFFE
  } 
  #propagate_down: false
}

# layer { 
#   name: "motion_relu_spatial_5a" 
#   type: "ReLU" 
#   bottom: "spatial_down_5a" 
#   top: "spatial_down_5a"
# }


layer {
  name: "motion_spatial_grad_5a"
  type: "Convolution"
  bottom: "spatial_down_5a"
  top: "spatial_5a"
  param { lr_mult: 0 decay_mult: 0 } 
  param { lr_mult: 0 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 3
    pad: 1
    group: 32  # equal to num channels
    weight_filler { type: "sobel" }
    bias_filler { type: "constant" value: 0 } 
    engine: CAFFE
  } 
}

layer { 
  name: "reshape_motion_spatial_5a" 
  type: "Reshape" 
  bottom: "spatial_5a" 
  top: "spatial_grad_5a" 
  reshape_param { shape { dim: [-1, 32, 7, 7] } } 
  # include { phase: TRAIN }
} 

# layer {
#   name: "eltwise_motion_first_5a"
#   type: "Eltwise"
#   bottom: "spatial_5a"
#   bottom: "spatial_down_5a"
#   top: "spatial_grad_5a"
#   eltwise_param {
#     operation: SUM
#     coeff: 1 
#     coeff: 1  # last frames - first frames
#   }
# }

layer { 
  name: "dropout" 
  top: "spatial_grad_5a" 
  bottom: "spatial_grad_5a" 
  type: "Dropout"
  dropout_param { dropout_ratio: 0.8 } 
}

# layer {
#   name: "eltwise_second_motion_5a"
#   type: "Eltwise"
#   bottom: "second_frames_5a"
#   bottom: "last_second_frames_5a"
#   top: "raw_motion_second_5a"
#   eltwise_param {
#     operation: SUM
#     coeff: -1 
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "eltwise_blank_5a"
#   type: "Eltwise"
#   bottom: "first_frame_5a"
#   bottom: "first_frame_5a"
#   top: "blank_5a"
#   eltwise_param {
#     operation: SUM
#     coeff: -1
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "pad_second_5a"
#   type: "Concat"
#   bottom: "raw_motion_second_5a"
#   bottom: "blank_5a"
#   top: "motion_second_5a"
# }

# layer { 
#   name: "reshape_motion_second_frames_5a" 
#   type: "Reshape" 
#   bottom: "motion_second_5a" 
#   top: "reshape_motion_second_frames_5a" 
#   reshape_param { shape { dim: [-1, 128, 7, 7] } } 
#   # include { phase: TRAIN }
# } 


layer{
  name: "concat_first_second_5a"
  type: "Concat"
  bottom: "spatial_grad_5a"
  bottom: "temporal_grad_5a"
  top: "motion_5a"
}



###################################### motion_5b ######################################



layer { 
  name: "motion_conv_gen_5b" 
  type: "Convolution" 
  bottom: "inception_5b/output" 
  top: "motion_conv_gen_5b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 128 
    kernel_size: 1
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_gen_5b" 
  type: "ReLU" 
  bottom: "motion_conv_gen_5b" 
  top: "motion_conv_gen_5b" 
}

layer { 
  name: "reshape_rgb_frames_5b" 
  type: "Reshape" 
  bottom: "motion_conv_gen_5b" 
  top: "reshape_rgb_frames_5b" 
  reshape_param { shape { dim: [16, -1, 7, 7] } } 
  include { phase: TRAIN }
} 

layer { 
  name: "reshape_rgb_frames_5b" 
  type: "Reshape" 
  bottom: "motion_conv_gen_5b" 
  top: "reshape_rgb_frames_5b" 
  reshape_param { shape { dim: [1, -1, 7, 7] } } 
  include { phase: TEST }
} 



layer {
  name: "slice_motion_last_5b"
  type: "Slice"
  bottom: "reshape_rgb_frames_5b"
  top: "first_frame_5b"
  top: "last_frames_5b"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_5b"
  type: "Slice"
  bottom: "reshape_rgb_frames_5b"
  top: "first_frames_5b"
  top: "last_frame_5b"
  slice_param {
    axis: 1
    slice_point: 768# 24*1024
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_last_5b"
  type: "Slice"
  bottom: "reshape_rgb_frames_5b"
  top: "first_frame_5b"
  top: "last_frames_5b"
  slice_param {
    axis: 1
    slice_point: 128
  }
  include { phase: TEST }
}

layer {
  name: "slice_motion_first_5b"
  type: "Slice"
  bottom: "reshape_rgb_frames_5b"
  top: "first_frames_5b"
  top: "last_frame_5b"
  slice_param {
    axis: 1
    slice_point: 3072#6144 #3072# 24*1024
  }
  include { phase: TEST }
}


# layer {
#   name: "slice_motion_last_second_5b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_5b"
#   top: "second_frame_5b"
#   top: "last_second_frames_5b"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TRAIN }
# }

# layer {
#   name: "slice_motion_second_5b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_5b"
#   top: "second_frames_5b"
#   top: "last_second_frame_5b"
#   slice_param {
#     axis: 1
#     slice_point: 640
#   }
#   include { phase: TRAIN }
# }



# layer {
#   name: "slice_motion_last_second_5b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_5b"
#   top: "second_frame_5b"
#   top: "last_second_frames_5b"
#   slice_param {
#     axis: 1
#     slice_point: 256
#   }
#   include { phase: TEST }
# }

# layer {
#   name: "slice_motion_second_5b"
#   type: "Slice"
#   bottom: "reshape_rgb_frames_5b"
#   top: "second_frames_5b"
#   top: "last_second_frame_5b"
#   slice_param {
#     axis: 1
#     slice_point: 2944
#   }
#   include { phase: TEST }
# }

# layer{
#   name: "silence_first_frame_5b"
#   type: "Silence"
#   bottom: "second_frame_5b"
# }

# layer{
#   name: "silence_last_frame_5b"
#   type: "Silence"
#   bottom: "last_second_frame_5b"
# }

layer{
  name: "silence_first_frame_5b"
  type: "Silence"
  bottom: "first_frame_5b"
}

layer{
  name: "silence_last_frame_5b"
  type: "Silence"
  bottom: "last_frame_5b"
}


layer {
  name: "eltwise_motion_first_5b"
  type: "Eltwise"
  bottom: "first_frames_5b"
  bottom: "last_frames_5b"
  top: "motion_first_5b"
  eltwise_param {
    operation: SUM
    coeff: -1 
    coeff: 1  # last frames - first frames
  }
}


layer { 
  name: "reshape_motion_first_frames_5b" 
  type: "Reshape" 
  bottom: "motion_first_5b" 
  top: "temporal_grad_5b" 
  reshape_param { shape { dim: [-1, 128, 7, 7] } } 
  # include { phase: TRAIN }
} 







# layer { 
#   name: "reshape_rgb_frames_5b" 
#   type: "Reshape" 
#   bottom: "inception_5b/output" 
#   top: "reshape_spatial_frames_5b" 
#   reshape_param { shape { dim: [16, -1, 7, 7] } } 
#   include { phase: TRAIN }
# } 

# layer { 
#   name: "reshape_rgb_frames_5b" 
#   type: "Reshape" 
#   bottom: "inception_5b/output" 
#   top: "reshape_spatial_frames_5b" 
#   reshape_param { shape { dim: [1, -1, 7, 7] } } 
#   include { phase: TEST }
# } 

layer {
  name: "slice_motion_first_5b"
  type: "Slice"
  bottom: "inception_5b/output"
  top: "spatial_frames_5b"
  top: "spatial_frame_5b"
  slice_param {
    axis: 0
    slice_point: 96  # 16x6
  }
  include { phase: TRAIN }
}

layer {
  name: "slice_motion_first_5b"
  type: "Slice"
  bottom: "inception_5b/output"
  top: "spatial_frames_5b"
  top: "spatial_frame_5b"
  slice_param {
    axis: 0
    slice_point: 24  # 16x24
  }
  include { phase: TEST }
}

layer{
  name: "silence_last_frame_5b"
  type: "Silence"
  bottom: "spatial_frame_5b"
}


layer {
  name: "reshape_spatial_5b"
  type: "Reshape"
  bottom: "spatial_frames_5b"
  top: "spatial_input_5b"
  reshape_param { shape { dim: [96, -1, 7, 7] } } 
  include { phase: TRAIN }
}

layer {
  name: "reshape_spatial_5b"
  type: "Reshape"
  bottom: "spatial_frames_5b"
  top: "spatial_input_5b"
  reshape_param { shape { dim: [24, -1, 7, 7] } } 
  include { phase: TEST }
}


layer {
  name: "motion_spatial_down_5b"
  type: "Convolution"
  bottom: "spatial_input_5b"
  top: "spatial_down_5b"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 1
    # pad: 1
    # group: 32  # equal to num channels
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
    engine: CAFFE
  } 
  #propagate_down: false
}

# layer { 
#   name: "motion_relu_spatial_5b" 
#   type: "ReLU" 
#   bottom: "spatial_down_5b" 
#   top: "spatial_down_5b"
# }

layer {
  name: "motion_spatial_grad_5b"
  type: "Convolution"
  bottom: "spatial_down_5b"
  top: "spatial_5b"
  param { lr_mult: 0 decay_mult: 0 } 
  param { lr_mult: 0 decay_mult: 0 }
  convolution_param { 
    num_output: 32
    kernel_size: 3
    pad: 1
    group: 32  # equal to num channels
    weight_filler { type: "sobel" }
    bias_filler { type: "constant" value: 0 } 
    engine: CAFFE
  } 
}

layer { 
  name: "reshape_motion_spatial_5b" 
  type: "Reshape" 
  bottom: "spatial_5b" 
  top: "spatial_grad_5b" 
  reshape_param { shape { dim: [-1, 32, 7, 7] } } 
  # include { phase: TRAIN }
} 

# layer {
#   name: "eltwise_motion_first_5b"
#   type: "Eltwise"
#   bottom: "spatial_5b"
#   bottom: "spatial_down_5b"
#   top: "spatial_grad_5b"
#   eltwise_param {
#     operation: SUM
#     coeff: 1 
#     coeff: 1  # last frames - first frames
#   }
# }

layer { 
  name: "dropout" 
  top: "spatial_grad_5b" 
  bottom: "spatial_grad_5b" 
  type: "Dropout"
  dropout_param { dropout_ratio: 0.8 } 
}

# layer {
#   name: "eltwise_second_motion_5b"
#   type: "Eltwise"
#   bottom: "second_frames_5b"
#   bottom: "last_second_frames_5b"
#   top: "raw_motion_second_5b"
#   eltwise_param {
#     operation: SUM
#     coeff: -1 
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "eltwise_blank_5b"
#   type: "Eltwise"
#   bottom: "first_frame_5b"
#   bottom: "first_frame_5b"
#   top: "blank_5b"
#   eltwise_param {
#     operation: SUM
#     coeff: -1
#     coeff: 1  # last frames - first frames
#   }
# }

# layer {
#   name: "pad_second_5b"
#   type: "Concat"
#   bottom: "raw_motion_second_5b"
#   bottom: "blank_5b"
#   top: "motion_second_5b"
# }

# layer { 
#   name: "reshape_motion_second_frames_5b" 
#   type: "Reshape" 
#   bottom: "motion_second_5b" 
#   top: "reshape_motion_second_frames_5b" 
#   reshape_param { shape { dim: [-1, 128, 7, 7] } } 
#   # include { phase: TRAIN }
# } 


layer{
  name: "concat_first_second_5b"
  type: "Concat"
  bottom: "spatial_grad_5b"
  bottom: "temporal_grad_5b"
  top: "motion_5b"
}


layer {
  name: "motion_fusion"
  type: "Concat"
  bottom: "motion_5a"
  bottom: "motion_5b"
  bottom: "motion_sum_14b"
  top: "motion_fusion"
  concat_param {
    axis: 1
  }
}

# layer { 
#   name: "motion_scale" 
#   type: "Scale" 
#   bottom: "motion_fusion" 
#   top: "motion_scale"
#   param { lr_mult: 1 decay_mult: 1 } 
#   param { lr_mult: 2 decay_mult: 0 }
#   scale_param { 
#     filler { type: "msra" } 
#     bias_term: true     
#     bias_filler { type: "constant" value: 0.2 }
#   } 
# }



layer { 
  name: "motion_conv_trans" 
  type: "Convolution" 
  bottom: "motion_fusion" 
  top: "motion_conv_trans"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 256
    kernel_size: 3
    pad: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans" 
  type: "ReLU" 
  bottom: "motion_conv_trans" 
  top: "motion_conv_trans"
}



layer { 
  name: "motion_conv1_trans" 
  type: "Convolution" 
  bottom: "motion_conv_trans" 
  top: "motion_conv1_trans"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 256
    kernel_size: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans" 
  type: "ReLU" 
  bottom: "motion_conv1_trans" 
  top: "motion_conv1_trans"
}

layer { 
  name: "motion_conv2_trans" 
  type: "Convolution" 
  bottom: "motion_conv1_trans" 
  top: "motion_conv2_trans"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 256
    kernel_size: 3
    pad: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_relu_trans" 
  type: "ReLU" 
  bottom: "motion_conv2_trans" 
  top: "motion_conv2_trans"
}

layer { 
  name: "motion_conv3_trans" 
  type: "Convolution" 
  bottom: "motion_conv2_trans" 
  top: "motion_conv3_trans"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 1024
    kernel_size: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer { 
  name: "motion_conv_branch_trans" 
  type: "Convolution" 
  bottom: "motion_conv_trans" 
  top: "motion_conv_branch_trans"
  param { lr_mult: 1 decay_mult: 1 } 
  param { lr_mult: 2 decay_mult: 0 }
  convolution_param { 
    num_output: 1024
    kernel_size: 1
    # stride: 2
    weight_filler { type: "msra" }
    bias_filler { type: "constant" value: 0.2 } 
  } 
}

layer {
  name: "motion_sum"
  type: "Eltwise"
  bottom: "motion_conv3_trans"
  bottom: "motion_conv_branch_trans"
  top: "motion_sum"
}



layer { name: "global_pool_motion" top: "global_pool_motion" bottom: "motion_sum" type: "Pooling"
  pooling_param { pool: AVE kernel_size: 7 stride: 1 } }

layer { name: "dropout_motion" top: "global_pool_motion" bottom: "global_pool_motion" type: "Dropout"
 dropout_param { dropout_ratio: 0.8 } }


layer { name: "fc-action-motion" type: "InnerProduct" bottom: "global_pool_motion" top: "fc_motion"
  param { lr_mult: 1 decay_mult: 1 } param { lr_mult: 2 decay_mult: 0 }
  inner_product_param { 
    num_output: 101
    weight_filler { type: "gaussian" std: 0.001 }
    bias_filler { type: "constant" value: 0 } 
  }
}
